{"ast":null,"code":"import _createForOfIteratorHelper from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _objectSpread from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regeneratorRuntime from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport globalService from \"@/services/global.service\";\nimport administratorAPI from \"@/views/modules/administrator/administrator.api\";\nimport EditCategoryVue from \"./EditCategory.vue\";\nimport DeleteDialogVue from \"@/components/DeleteDialog.vue\";\nimport BreadcrumbsVue from \"@/components/Breadcrumbs.vue\";\nexport default {\n  name: \"CategoryList\",\n  components: {\n    EditCategoryVue: EditCategoryVue,\n    DeleteDialogVue: DeleteDialogVue,\n    BreadcrumbsVue: BreadcrumbsVue\n  },\n  data: function data() {\n    return {\n      loading: true,\n      dialog: {\n        edit: false,\n        delete: false\n      },\n      search: \"\",\n      selected: [],\n      selectedParent: [],\n      root: [],\n      selectedItem: {},\n      raw: [],\n      showAllText: false\n    };\n  },\n  created: function created() {\n    this.$Progress.start();\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.$Progress.finish();\n\n              _this.initialize();\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    initialize: function initialize() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var response, children, rerun, _iterator, _step, _loop2, _ret2, _loop, _i, _rerun, _ret;\n\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this2.dialog.edit = false;\n                _this2.dialog.delete = false;\n                _context2.prev = 2;\n                _context2.next = 5;\n                return globalService.getData_Async(administratorAPI.API_GetAllCategoryGroup());\n\n              case 5:\n                response = _context2.sent;\n\n                if (response) {\n                  _context2.next = 9;\n                  break;\n                }\n\n                _this2.errorLoad();\n\n                return _context2.abrupt(\"return\");\n\n              case 9:\n                if (response.state) {\n                  _context2.next = 12;\n                  break;\n                }\n\n                _this2.errorLoad();\n\n                return _context2.abrupt(\"return\");\n\n              case 12:\n                _this2.raw = response.data.filter(function (entry) {\n                  return !entry.isDelete;\n                });\n                _this2.root = response.data.filter(function (entry) {\n                  return !entry.parent && !entry.isDelete;\n                }).map(function (entry) {\n                  return _objectSpread(_objectSpread({}, entry), {}, {\n                    children: []\n                  });\n                });\n                children = response.data.filter(function (entry) {\n                  return !!entry.parent && !entry.isDelete;\n                });\n                rerun = [];\n                _iterator = _createForOfIteratorHelper(children);\n                _context2.prev = 17;\n\n                _loop2 = function _loop2() {\n                  var child = _step.value;\n\n                  var parent = _this2.findParent(child.parent.id, _this2.root);\n\n                  if (!parent) {\n                    if (children.find(function (entry) {\n                      return child.parent.id == entry.id;\n                    })) {\n                      rerun.push(child);\n                    }\n\n                    return \"continue\";\n                  }\n\n                  if (!child.children) {\n                    child.children = [];\n                  }\n\n                  parent.children.push(child);\n                };\n\n                _iterator.s();\n\n              case 20:\n                if ((_step = _iterator.n()).done) {\n                  _context2.next = 26;\n                  break;\n                }\n\n                _ret2 = _loop2();\n\n                if (!(_ret2 === \"continue\")) {\n                  _context2.next = 24;\n                  break;\n                }\n\n                return _context2.abrupt(\"continue\", 24);\n\n              case 24:\n                _context2.next = 20;\n                break;\n\n              case 26:\n                _context2.next = 31;\n                break;\n\n              case 28:\n                _context2.prev = 28;\n                _context2.t0 = _context2[\"catch\"](17);\n\n                _iterator.e(_context2.t0);\n\n              case 31:\n                _context2.prev = 31;\n\n                _iterator.f();\n\n                return _context2.finish(31);\n\n              case 34:\n                _loop = function _loop() {\n                  var child = _rerun[_i];\n\n                  var parent = _this2.findParent(child.parent.id, _this2.root);\n\n                  if (!parent) {\n                    if (children.find(function (entry) {\n                      return child.parentId == entry.id;\n                    })) {\n                      rerun.push(child);\n                    }\n\n                    return \"continue\";\n                  }\n\n                  if (!child.children) {\n                    child.children = [];\n                  }\n\n                  parent.children.push(child);\n                };\n\n                _i = 0, _rerun = rerun;\n\n              case 36:\n                if (!(_i < _rerun.length)) {\n                  _context2.next = 43;\n                  break;\n                }\n\n                _ret = _loop();\n\n                if (!(_ret === \"continue\")) {\n                  _context2.next = 40;\n                  break;\n                }\n\n                return _context2.abrupt(\"continue\", 40);\n\n              case 40:\n                _i++;\n                _context2.next = 36;\n                break;\n\n              case 43:\n                _this2.finishLoad();\n\n                _context2.next = 49;\n                break;\n\n              case 46:\n                _context2.prev = 46;\n                _context2.t1 = _context2[\"catch\"](2);\n\n                _this2.errorLoad(_context2.t1);\n\n              case 49:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[2, 46], [17, 28, 31, 34]]);\n      }))();\n    },\n    findParent: function findParent(parentId, root) {\n      var _iterator2 = _createForOfIteratorHelper(root),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var entry = _step2.value;\n\n          if (entry.id == parentId) {\n            return entry;\n          }\n\n          if (!entry.children || !entry.children.length) {\n            continue;\n          }\n\n          var result = this.findParent(parentId, entry.children);\n\n          if (!result) {\n            continue;\n          } else {\n            return result;\n          }\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    },\n    editItem: function editItem(item) {\n      this.$router.push({\n        path: administratorAPI.Route_EditCategroupGroup(item.id)\n      });\n    },\n    deleteItem: function deleteItem(item) {\n      this.selected = [item.id].concat();\n      this.selectedParent.push(item);\n      this.dialog.delete = true;\n    },\n    onConfirmDelete: function onConfirmDelete() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var response, data;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                data = _this3.raw.filter(function (entry) {\n                  return _this3.selected.includes(entry.id);\n                }).map(function (entry) {\n                  entry.isDelete = true;\n                  return entry;\n                });\n                data = data.concat(_this3.selectedParent);\n                _context3.next = 5;\n                return globalService.postData_Async(administratorAPI.API_SaveAllCategoryGroup(), data);\n\n              case 5:\n                response = _context3.sent;\n\n                if (response) {\n                  _context3.next = 8;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this3.toastError(_this3.$t(\"error.delete\")));\n\n              case 8:\n                if (response.state) {\n                  _context3.next = 10;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this3.toastError(_this3.$t(\"error.delete\")));\n\n              case 10:\n                _this3.toast(_this3.$t(\"success.delete\"));\n\n                _this3.closeDelete();\n\n                _this3.initialize();\n\n                _context3.next = 18;\n                break;\n\n              case 15:\n                _context3.prev = 15;\n                _context3.t0 = _context3[\"catch\"](0);\n\n                _this3.toastError(_context3.t0);\n\n              case 18:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[0, 15]]);\n      }))();\n    },\n    closeDelete: function closeDelete() {\n      this.selectedParent = [];\n      this.dialog.delete = false;\n    },\n    deleteAll: function deleteAll() {\n      this.dialog.delete = true;\n    },\n    editCategoryGroup: function editCategoryGroup() {\n      var item = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.selected = [item].concat();\n      this.selectedItem = item; // this.selectedItem.children = null;\n\n      this.dialog.edit = true;\n    },\n    createChild: function createChild(parent) {\n      this.selectedItem = {};\n      this.selectedItem.parent = parent;\n      this.dialog.edit = true;\n    },\n    closeEditDialog: function closeEditDialog(value) {\n      if (value) {\n        this.dialog.edit = false;\n      }\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["name","components","EditCategoryVue","DeleteDialogVue","BreadcrumbsVue","data","loading","dialog","edit","delete","search","selected","selectedParent","root","selectedItem","raw","showAllText","created","mounted","methods","initialize","globalService","administratorAPI","response","filter","map","children","rerun","child","parent","findParent","parentId","editItem","item","path","deleteItem","onConfirmDelete","entry","closeDelete","deleteAll","editCategoryGroup","createChild","closeEditDialog","value"],"sourceRoot":"src/views/modules/administrator/Category","sources":["CategoryList.vue"],"sourcesContent":["<template>\r\n\t<v-card elevation=\"0\">\r\n\t\t<BreadcrumbsVue />\r\n\t\t<v-dialog v-model=\"dialog.delete\" persistent max-width=\"fit-content\">\r\n\t\t\t<DeleteDialogVue\r\n\t\t\t\t@close=\"onCloseDialog\"\r\n\t\t\t\t@confirmDelete=\"onConfirmDelete\"\r\n\t\t\t/>\r\n\t\t</v-dialog>\r\n\t\t<v-dialog v-model=\"dialog.edit\" persistent max-width=\"40vw\">\r\n\t\t\t<EditCategoryVue\r\n\t\t\t\t:categoryGroupDto=\"selectedItem\"\r\n\t\t\t\t:categoryGroupDtos=\"raw\"\r\n\t\t\t\t:edit=\"dialog.edit\"\r\n\t\t\t\t@save=\"initialize\"\r\n\t\t\t\t@cancel=\"closeEditDialog\"\r\n\t\t\t>\r\n\t\t\t</EditCategoryVue>\r\n\t\t</v-dialog>\r\n\t\t<template>\r\n\t\t\t<v-card-title>\r\n\t\t\t\t<v-btn\r\n\t\t\t\t\televation=\"0\"\r\n\t\t\t\t\ttext\r\n\t\t\t\t\tclass=\"rounded-0\"\r\n\t\t\t\t\t@click=\"editCategoryGroup\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<v-icon>mdi-plus</v-icon>\r\n\t\t\t\t\t{{ $t(\"button.insert\") }}\r\n\t\t\t\t</v-btn>\r\n\t\t\t\t<v-btn\r\n\t\t\t\t\tv-if=\"selected.length > 0\"\r\n\t\t\t\t\televation=\"0\"\r\n\t\t\t\t\ttext\r\n\t\t\t\t\tclass=\"rounded-0\"\r\n\t\t\t\t\t@click.stop=\"deleteAll\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<v-icon>mdi-trash-can-outline</v-icon>\r\n\t\t\t\t\t{{ $t(\"button.delete_all\") }}\r\n\t\t\t\t</v-btn>\r\n\t\t\t</v-card-title>\r\n\t\t</template>\r\n\t\t<v-card-text>\r\n\t\t\t<v-treeview\r\n\t\t\t\tv-model=\"selected\"\r\n\t\t\t\tselectable\r\n\t\t\t\tselection-type=\"independent\"\r\n\t\t\t\t:items=\"root\"\r\n\t\t\t\topen-on-click\r\n\t\t\t>\r\n\t\t\t\t<template v-slot:prepend=\"{ item, open }\">\r\n\t\t\t\t\t<v-icon v-if=\"item.children && item.children.length\">\r\n\t\t\t\t\t\t{{ open ? \"mdi-folder-open\" : \"mdi-folder\" }}\r\n\t\t\t\t\t</v-icon>\r\n\t\t\t\t</template>\r\n\t\t\t\t<template v-slot:label=\"{ item }\">\r\n\t\t\t\t\t<span v-if=\"item.name.length > 50 && !showAllText\">\r\n\t\t\t\t\t\t{{ item.name.slice(0, 50) }}\r\n\t\t\t\t\t\t<a href=\"#\" @click=\"showAllText = !showAllText\">\r\n\t\t\t\t\t\t\t{{ $t(\"button.details\") }}\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<span\r\n\t\t\t\t\t\tv-if=\"item.name.length > 50 && showAllText\"\r\n\t\t\t\t\t\tstyle=\"white-space: normal\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{{ item.name }}\r\n\t\t\t\t\t\t<a href=\"#\" @click=\"showAllText = !showAllText\">\r\n\t\t\t\t\t\t\t{{ $t(\"button.hide\") }}\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<span v-if=\"item.name.length <= 50\">\r\n\t\t\t\t\t\t{{ item.name }}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<v-menu\r\n\t\t\t\t\t\ttransition=\"slide-y-transition\"\r\n\t\t\t\t\t\tbottom\r\n\t\t\t\t\t\topen-on-click\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<template v-slot:activator=\"{ on, attrs }\">\r\n\t\t\t\t\t\t\t<v-btn\r\n\t\t\t\t\t\t\t\tcolor=\"grey darken-2\"\r\n\t\t\t\t\t\t\t\tdark\r\n\t\t\t\t\t\t\t\ticon\r\n\t\t\t\t\t\t\t\tv-bind=\"attrs\"\r\n\t\t\t\t\t\t\t\tv-on=\"on\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<v-icon>mdi-dots-vertical</v-icon>\r\n\t\t\t\t\t\t\t</v-btn>\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t<v-list>\r\n\t\t\t\t\t\t\t<v-list-item @click=\"createChild(item)\">\r\n\t\t\t\t\t\t\t\t<v-list-item-icon>\r\n\t\t\t\t\t\t\t\t\t<v-icon color=\"green darken-2\">\r\n\t\t\t\t\t\t\t\t\t\tmdi-plus-circle\r\n\t\t\t\t\t\t\t\t\t</v-icon>\r\n\t\t\t\t\t\t\t\t</v-list-item-icon>\r\n\t\t\t\t\t\t\t\t<v-list-item-title>{{\r\n\t\t\t\t\t\t\t\t\t$t(\"button.add\")\r\n\t\t\t\t\t\t\t\t}}</v-list-item-title>\r\n\t\t\t\t\t\t\t</v-list-item>\r\n\t\t\t\t\t\t\t<v-list-item @click=\"editCategoryGroup(item)\">\r\n\t\t\t\t\t\t\t\t<v-list-item-icon>\r\n\t\t\t\t\t\t\t\t\t<v-icon color=\"blue darken-2\">\r\n\t\t\t\t\t\t\t\t\t\tmdi-pencil\r\n\t\t\t\t\t\t\t\t\t</v-icon>\r\n\t\t\t\t\t\t\t\t</v-list-item-icon>\r\n\t\t\t\t\t\t\t\t<v-list-item-title>{{\r\n\t\t\t\t\t\t\t\t\t$t(\"button.edit\")\r\n\t\t\t\t\t\t\t\t}}</v-list-item-title>\r\n\t\t\t\t\t\t\t</v-list-item>\r\n\t\t\t\t\t\t\t<v-list-item @click=\"deleteItem(item)\">\r\n\t\t\t\t\t\t\t\t<v-list-item-icon>\r\n\t\t\t\t\t\t\t\t\t<v-icon color=\"red darken-2\">\r\n\t\t\t\t\t\t\t\t\t\tmdi-trash-can-outline\r\n\t\t\t\t\t\t\t\t\t</v-icon>\r\n\t\t\t\t\t\t\t\t</v-list-item-icon>\r\n\t\t\t\t\t\t\t\t<v-list-item-title color=\"red darken-2\">{{\r\n\t\t\t\t\t\t\t\t\t$t(\"button.delete\")\r\n\t\t\t\t\t\t\t\t}}</v-list-item-title>\r\n\t\t\t\t\t\t\t</v-list-item>\r\n\t\t\t\t\t\t</v-list>\r\n\t\t\t\t\t</v-menu>\r\n\t\t\t\t\t<v-divider></v-divider>\r\n\t\t\t\t</template>\r\n\t\t\t</v-treeview>\r\n\t\t</v-card-text>\r\n\t</v-card>\r\n</template>\r\n\r\n<script>\r\nimport globalService from \"@/services/global.service\";\r\nimport administratorAPI from \"@/views/modules/administrator/administrator.api\";\r\nimport EditCategoryVue from \"./EditCategory.vue\";\r\nimport DeleteDialogVue from \"@/components/DeleteDialog.vue\";\r\nimport BreadcrumbsVue from \"@/components/Breadcrumbs.vue\";\r\nexport default {\r\n\tname: \"CategoryList\",\r\n\tcomponents: { EditCategoryVue, DeleteDialogVue, BreadcrumbsVue },\r\n\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tloading: true,\r\n\t\t\tdialog: {\r\n\t\t\t\tedit: false,\r\n\t\t\t\tdelete: false,\r\n\t\t\t},\r\n\t\t\tsearch: \"\",\r\n\t\t\tselected: [],\r\n\t\t\tselectedParent: [],\r\n\t\t\troot: [],\r\n\t\t\tselectedItem: {},\r\n\t\t\traw: [],\r\n\t\t\tshowAllText: false,\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.$Progress.start();\r\n\t},\r\n\tasync mounted() {\r\n\t\tthis.$Progress.finish();\r\n\t\tthis.initialize();\r\n\t},\r\n\tmethods: {\r\n\t\tasync initialize() {\r\n\t\t\tthis.dialog.edit = false;\r\n\t\t\tthis.dialog.delete = false;\r\n\t\t\tlet response;\r\n\t\t\ttry {\r\n\t\t\t\tresponse = await globalService.getData_Async(\r\n\t\t\t\t\tadministratorAPI.API_GetAllCategoryGroup(),\r\n\t\t\t\t);\r\n\t\t\t\tif (!response) {\r\n\t\t\t\t\tthis.errorLoad();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (!response.state) {\r\n\t\t\t\t\tthis.errorLoad();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.raw = response.data.filter((entry) => {\r\n\t\t\t\t\treturn !entry.isDelete;\r\n\t\t\t\t});\r\n\t\t\t\tthis.root = response.data\r\n\t\t\t\t\t.filter((entry) => {\r\n\t\t\t\t\t\treturn !entry.parent && !entry.isDelete;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.map((entry) => {\r\n\t\t\t\t\t\treturn { ...entry, children: [] };\r\n\t\t\t\t\t});\r\n\t\t\t\tlet children = response.data.filter((entry) => {\r\n\t\t\t\t\treturn !!entry.parent && !entry.isDelete;\r\n\t\t\t\t});\r\n\t\t\t\tlet rerun = [];\r\n\t\t\t\tfor (let child of children) {\r\n\t\t\t\t\tlet parent = this.findParent(child.parent.id, this.root);\r\n\t\t\t\t\tif (!parent) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tchildren.find((entry) => {\r\n\t\t\t\t\t\t\t\treturn child.parent.id == entry.id;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\trerun.push(child);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!child.children) {\r\n\t\t\t\t\t\tchild.children = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparent.children.push(child);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let child of rerun) {\r\n\t\t\t\t\tlet parent = this.findParent(child.parent.id, this.root);\r\n\t\t\t\t\tif (!parent) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tchildren.find((entry) => {\r\n\t\t\t\t\t\t\t\treturn child.parentId == entry.id;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\trerun.push(child);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!child.children) {\r\n\t\t\t\t\t\tchild.children = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparent.children.push(child);\r\n\t\t\t\t}\r\n\t\t\t\tthis.finishLoad();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.errorLoad(error);\r\n\t\t\t}\r\n\t\t},\r\n\t\tfindParent(parentId, root) {\r\n\t\t\tfor (let entry of root) {\r\n\t\t\t\tif (entry.id == parentId) {\r\n\t\t\t\t\treturn entry;\r\n\t\t\t\t}\r\n\t\t\t\tif (!entry.children || !entry.children.length) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tlet result = this.findParent(parentId, entry.children);\r\n\t\t\t\tif (!result) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\teditItem(item) {\r\n\t\t\tthis.$router.push({\r\n\t\t\t\tpath: administratorAPI.Route_EditCategroupGroup(item.id),\r\n\t\t\t});\r\n\t\t},\r\n\t\tdeleteItem(item) {\r\n\t\t\tthis.selected = [...[item.id]];\r\n\t\t\tthis.selectedParent.push(item);\r\n\t\t\tthis.dialog.delete = true;\r\n\t\t},\r\n\t\tasync onConfirmDelete() {\r\n\t\t\tlet response;\r\n\t\t\ttry {\r\n\t\t\t\tlet data = this.raw\r\n\t\t\t\t\t.filter((entry) => {\r\n\t\t\t\t\t\treturn this.selected.includes(entry.id);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.map((entry) => {\r\n\t\t\t\t\t\tentry.isDelete = true;\r\n\t\t\t\t\t\treturn entry;\r\n\t\t\t\t\t});\r\n\t\t\t\tdata = data.concat(this.selectedParent);\r\n\t\t\t\tresponse = await globalService.postData_Async(\r\n\t\t\t\t\tadministratorAPI.API_SaveAllCategoryGroup(),\r\n\t\t\t\t\tdata,\r\n\t\t\t\t);\r\n\t\t\t\tif (!response) {\r\n\t\t\t\t\treturn this.toastError(this.$t(\"error.delete\"));\r\n\t\t\t\t}\r\n\t\t\t\tif (!response.state) {\r\n\t\t\t\t\treturn this.toastError(this.$t(\"error.delete\"));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.toast(this.$t(\"success.delete\"));\r\n\r\n\t\t\t\tthis.closeDelete();\r\n\t\t\t\tthis.initialize();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.toastError(error);\r\n\t\t\t}\r\n\t\t},\r\n\t\tcloseDelete() {\r\n\t\t\tthis.selectedParent = [];\r\n\t\t\tthis.dialog.delete = false;\r\n\t\t},\r\n\t\tdeleteAll() {\r\n\t\t\tthis.dialog.delete = true;\r\n\t\t},\r\n\t\teditCategoryGroup(item = {}) {\r\n\t\t\tthis.selected = [...[item]];\r\n\t\t\tthis.selectedItem = item;\r\n\t\t\t// this.selectedItem.children = null;\r\n\t\t\tthis.dialog.edit = true;\r\n\t\t},\r\n\t\tcreateChild(parent) {\r\n\t\t\tthis.selectedItem = {};\r\n\t\t\tthis.selectedItem.parent = parent;\r\n\t\t\tthis.dialog.edit = true;\r\n\t\t},\r\n\t\tcloseEditDialog(value) {\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.dialog.edit = false;\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<style></style>\r\n"]},"metadata":{},"sourceType":"module"}