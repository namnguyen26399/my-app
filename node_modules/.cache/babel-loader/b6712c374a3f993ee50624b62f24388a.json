{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _createForOfIteratorHelper from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _asyncToGenerator from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.splice.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport globalService from \"@/services/global.service\";\nimport VuePerfectScrollbar from \"vue-perfect-scrollbar\";\nimport constant from \"@/common/constant\";\nimport administratorAPI from \"../../administrator/administrator.api\";\nexport default {\n  name: \"VSMFEAttachmentFileRequestData\",\n  components: {\n    VuePerfectScrollbar: VuePerfectScrollbar\n  },\n  props: {\n    requestDataV2: {},\n    parent: parent\n  },\n  watch: {\n    parent: function parent() {\n      this.files = [];\n    },\n    requestDataV2: function requestDataV2(newValue) {\n      this.requestData = newValue;\n    }\n  },\n  data: function data() {\n    return {\n      files: {},\n      isDragOver: false,\n      requestData: {},\n      user_info: this.getUserInfo(),\n      attachmentFiles: []\n    };\n  },\n  created: function created() {\n    this.requestData = this.requestDataV2;\n  },\n  computed: {},\n  mounted: function mounted() {},\n  methods: {\n    handleFile: function handleFile(files) {\n      console.log(\"files: \", files);\n      this.files = Array.from(files.target.files);\n      console.log(\"files: \", this.files);\n    },\n    onDrop: function onDrop(event) {\n      event.preventDefault();\n      this.isDragOver = false;\n\n      if (event.dataTransfer) {\n        this.files = Array.from(event.dataTransfer.files);\n      }\n    },\n    onDragEnd: function onDragEnd(event) {\n      event.preventDefault();\n      this.isDragOver = false;\n    },\n    onDragEnter: function onDragEnter(event) {\n      event.preventDefault();\n      this.isDragOver = true;\n    },\n    onDragLeave: function onDragLeave(event) {\n      event.preventDefault();\n      this.isDragOver = false;\n    },\n    onDragOver: function onDragOver(event) {\n      event.preventDefault();\n      this.isDragOver = true;\n    },\n    onClick: function onClick(event) {\n      event.preventDefault();\n      var files = document.getElementById(constant.keys.files);\n      files.click();\n    },\n    remove: function remove(file) {\n      var index = this.files.indexOf(file);\n      this.files.splice(index, 1);\n    },\n    upload: function upload() {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var response, _iterator, _step, file;\n\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (_this.files) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                _context.prev = 2;\n                _iterator = _createForOfIteratorHelper(_this.files);\n                _context.prev = 4;\n\n                _iterator.s();\n\n              case 6:\n                if ((_step = _iterator.n()).done) {\n                  _context.next = 22;\n                  break;\n                }\n\n                file = _step.value;\n                console.log(\"file\", file);\n                console.log(\"this.requestData: \", _this.requestData);\n                _context.next = 12;\n                return globalService.uploadData_Async(administratorAPI.API_UploadFile365(), file, {\n                  parentItemId: _this.requestData.idDirectoryPath,\n                  userId: _this.userInfo.id,\n                  requestDataId: _this.requestData.id\n                });\n\n              case 12:\n                response = _context.sent;\n\n                if (response) {\n                  _context.next = 15;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", _this.toastError(_this.$t(\"error.upload_file\")));\n\n              case 15:\n                if (response.state) {\n                  _context.next = 17;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", _this.toastError(response.message));\n\n              case 17:\n                _this.attachmentFiles.push(response.data);\n\n                console.log(\"response file\", response);\n                _this.files = []; //this.$emit(constant.keys.upload, true);\n\n              case 20:\n                _context.next = 6;\n                break;\n\n              case 22:\n                _context.next = 27;\n                break;\n\n              case 24:\n                _context.prev = 24;\n                _context.t0 = _context[\"catch\"](4);\n\n                _iterator.e(_context.t0);\n\n              case 27:\n                _context.prev = 27;\n\n                _iterator.f();\n\n                return _context.finish(27);\n\n              case 30:\n                _this.$emit(\"save\", _this.attachmentFiles);\n\n                _this.closeDialog();\n\n                _context.next = 37;\n                break;\n\n              case 34:\n                _context.prev = 34;\n                _context.t1 = _context[\"catch\"](2);\n\n                _this.toastError(_context.t1);\n\n              case 37:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 34], [4, 24, 27, 30]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+EA;AACA;AACA;AACA;AACA;EACAA,sCADA;EAGAC;IAAAC;EAAA,CAHA;EAIAC;IAAAC;IAAAC;EAAA,CAJA;EAKAC;IACAD,MADA,oBACA;MACA;IACA,CAHA;IAIAD,aAJA,yBAIAG,QAJA,EAIA;MACA;IACA;EANA,CALA;EAaAC,IAbA,kBAaA;IACA;MACAC,SADA;MAEAC,iBAFA;MAGAC,eAHA;MAIAC,6BAJA;MAKAC;IALA;EAOA,CArBA;EAsBAC,OAtBA,qBAsBA;IACA;EACA,CAxBA;EAyBAC,YAzBA;EA0BAC,OA1BA,qBA0BA,EA1BA;EA2BAC;IACAC,UADA,sBACAT,KADA,EACA;MACAU;MACA;MACAA;IACA,CALA;IAMAC,MANA,kBAMAC,KANA,EAMA;MACAA;MACA;;MACA;QACA;MACA;IACA,CAZA;IAaAC,SAbA,qBAaAD,KAbA,EAaA;MACAA;MACA;IACA,CAhBA;IAiBAE,WAjBA,uBAiBAF,KAjBA,EAiBA;MACAA;MACA;IACA,CApBA;IAqBAG,WArBA,uBAqBAH,KArBA,EAqBA;MACAA;MACA;IACA,CAxBA;IAyBAI,UAzBA,sBAyBAJ,KAzBA,EAyBA;MACAA;MACA;IACA,CA5BA;IA6BAK,OA7BA,mBA6BAL,KA7BA,EA6BA;MACAA;MACA;MACAZ;IACA,CAjCA;IAkCAkB,MAlCA,kBAkCAC,IAlCA,EAkCA;MACA;MACA;IACA,CArCA;IAsCAC,MAtCA,oBAsCA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAAA,IACA,WADA;kBAAA;kBAAA;gBAAA;;gBAAA;;cAAA;gBAAA;gBAAA,uCAMA,WANA;gBAAA;;gBAAA;;cAAA;gBAAA;kBAAA;kBAAA;gBAAA;;gBAMAD,IANA;gBAOAT;gBACAA;gBARA;gBAAA,OASAW,+BACAC,oCADA,EAEAH,IAFA,EAGA;kBACAI,+CADA;kBAEAC,yBAFA;kBAGAC;gBAHA,CAHA,CATA;;cAAA;gBASAC,QATA;;gBAAA,IAkBAA,QAlBA;kBAAA;kBAAA;gBAAA;;gBAAA,iCAmBA,+CAnBA;;cAAA;gBAAA,IAqBAA,cArBA;kBAAA;kBAAA;gBAAA;;gBAAA,iCAsBA,kCAtBA;;cAAA;gBAwBA;;gBACAhB;gBACA,iBA1BA,CA2BA;;cA3BA;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA;;gBAAA;;cAAA;gBAAA;;gBAAA;;gBAAA;;cAAA;gBA6BA;;gBACA;;gBA9BA;gBAAA;;cAAA;gBAAA;gBAAA;;gBAgCA;;cAhCA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAkCA;EAxEA;AA3BA","names":["name","components","VuePerfectScrollbar","props","requestDataV2","parent","watch","newValue","data","files","isDragOver","requestData","user_info","attachmentFiles","created","computed","mounted","methods","handleFile","console","onDrop","event","onDragEnd","onDragEnter","onDragLeave","onDragOver","onClick","remove","file","upload","globalService","administratorAPI","parentItemId","userId","requestDataId","response"],"sourceRoot":"src/views/modules/khai-phieu-yeu-cau/RequestForm","sources":["AttachmentFileRequestData.vue"],"sourcesContent":["<template>\r\n\t<v-card elevation=\"0\">\r\n\t\t<v-toolbar flat>\r\n\t\t\t<v-toolbar-title class=\"font-bold\">\r\n\t\t\t\t{{ $t(\"title.upload_file\") }}</v-toolbar-title\r\n\t\t\t>\r\n\t\t\t<v-spacer></v-spacer>\r\n\t\t\t<v-btn icon @click=\"closeDialog\">\r\n\t\t\t\t<v-icon>mdi-close</v-icon>\r\n\t\t\t</v-btn>\r\n\t\t</v-toolbar>\r\n\t\t<v-card-text>\r\n\t\t\t<v-container class=\"mt-4\">\r\n\t\t\t\t<v-card\r\n\t\t\t\t\televation=\"0\"\r\n\t\t\t\t\tdropzone\r\n\t\t\t\t\t:class=\"\r\n\t\t\t\t\t\t!isDragOver\r\n\t\t\t\t\t\t\t? 'rounded-lg'\r\n\t\t\t\t\t\t\t: 'rounded-lg background-active'\r\n\t\t\t\t\t\"\r\n\t\t\t\t\t@drop=\"onDrop($event)\"\r\n\t\t\t\t\t@dragenter=\"onDragEnter($event)\"\r\n\t\t\t\t\t@dragleave=\"onDragLeave($event)\"\r\n\t\t\t\t\t@dragover=\"onDragOver($event)\"\r\n\t\t\t\t\t@dragend=\"onDragEnd($event)\"\r\n\t\t\t\t\t@click=\"onClick($event)\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\"d-flex justify-center border-2 p-2\">\r\n\t\t\t\t\t\t<v-icon x-large>mdi-cloud-upload-outline </v-icon>\r\n\t\t\t\t\t\t<v-card-text>\r\n\t\t\t\t\t\t\t{{ $t(\"label.drag_to_upload\") }}\r\n\t\t\t\t\t\t</v-card-text>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</v-card>\r\n\t\t\t\t<input\r\n\t\t\t\t\tref=\"files\"\r\n\t\t\t\t\tid=\"files\"\r\n\t\t\t\t\ttype=\"file\"\r\n\t\t\t\t\taccept=\".xlsx,.xls,image/*,.doc, .docx,.ppt, .pptx,.txt,.pdf\"\r\n\t\t\t\t\tclass=\"d-none\"\r\n\t\t\t\t\tmultiple\r\n\t\t\t\t\t@change=\"handleFile($event)\"\r\n\t\t\t\t/>\r\n\t\t\t\t<VuePerfectScrollbar class=\"h-60\">\r\n\t\t\t\t\t<v-list>\r\n\t\t\t\t\t\t<v-list-item v-for=\"file in files\" :key=\"file.name\">\r\n\t\t\t\t\t\t\t<v-list-item-icon>\r\n\t\t\t\t\t\t\t\t<v-icon>\r\n\t\t\t\t\t\t\t\t\t{{ m_files_icon[file.type] }}\r\n\t\t\t\t\t\t\t\t</v-icon>\r\n\t\t\t\t\t\t\t</v-list-item-icon>\r\n\t\t\t\t\t\t\t<v-list-item-content>\r\n\t\t\t\t\t\t\t\t<v-list-item-title>\r\n\t\t\t\t\t\t\t\t\t{{ file.name }}\r\n\t\t\t\t\t\t\t\t\t<v-icon\r\n\t\t\t\t\t\t\t\t\t\tcolor=\"red darken-2\"\r\n\t\t\t\t\t\t\t\t\t\t@click=\"remove(file)\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tmdi-delete-circle\r\n\t\t\t\t\t\t\t\t\t</v-icon>\r\n\t\t\t\t\t\t\t\t</v-list-item-title>\r\n\t\t\t\t\t\t\t</v-list-item-content>\r\n\t\t\t\t\t\t</v-list-item>\r\n\t\t\t\t\t</v-list>\r\n\t\t\t\t</VuePerfectScrollbar>\r\n\t\t\t</v-container>\r\n\t\t</v-card-text>\r\n\t\t<v-card-actions>\r\n\t\t\t<v-spacer> </v-spacer>\r\n\t\t\t<v-btn elevation=\"0\" @click=\"closeDialog\"> Hủy </v-btn>\r\n\t\t\t<v-btn color=\"blue darken-2\" dark elevation=\"0\" @click=\"upload()\">\r\n\t\t\t\tOK\r\n\t\t\t</v-btn>\r\n\t\t</v-card-actions>\r\n\t</v-card>\r\n</template>\r\n\r\n<script>\r\nimport globalService from \"@/services/global.service\";\r\nimport VuePerfectScrollbar from \"vue-perfect-scrollbar\";\r\nimport constant from \"@/common/constant\";\r\nimport administratorAPI from \"../../administrator/administrator.api\";\r\nexport default {\r\n\tname: \"VSMFEAttachmentFileRequestData\",\r\n\r\n\tcomponents: { VuePerfectScrollbar },\r\n\tprops: { requestDataV2: {}, parent },\r\n\twatch: {\r\n\t\tparent() {\r\n\t\t\tthis.files = [];\r\n\t\t},\r\n\t\trequestDataV2(newValue) {\r\n\t\t\tthis.requestData = newValue;\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tfiles: {},\r\n\t\t\tisDragOver: false,\r\n\t\t\trequestData: {},\r\n\t\t\tuser_info: this.getUserInfo(),\r\n\t\t\tattachmentFiles: [],\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.requestData = this.requestDataV2;\r\n\t},\r\n\tcomputed: {},\r\n\tmounted() {},\r\n\tmethods: {\r\n\t\thandleFile(files) {\r\n\t\t\tconsole.log(\"files: \", files);\r\n\t\t\tthis.files = Array.from(files.target.files);\r\n\t\t\tconsole.log(\"files: \", this.files);\r\n\t\t},\r\n\t\tonDrop(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.isDragOver = false;\r\n\t\t\tif (event.dataTransfer) {\r\n\t\t\t\tthis.files = Array.from(event.dataTransfer.files);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonDragEnd(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.isDragOver = false;\r\n\t\t},\r\n\t\tonDragEnter(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.isDragOver = true;\r\n\t\t},\r\n\t\tonDragLeave(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.isDragOver = false;\r\n\t\t},\r\n\t\tonDragOver(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.isDragOver = true;\r\n\t\t},\r\n\t\tonClick(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tlet files = document.getElementById(constant.keys.files);\r\n\t\t\tfiles.click();\r\n\t\t},\r\n\t\tremove(file) {\r\n\t\t\tlet index = this.files.indexOf(file);\r\n\t\t\tthis.files.splice(index, 1);\r\n\t\t},\r\n\t\tasync upload() {\r\n\t\t\tif (!this.files) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet response;\r\n\t\t\ttry {\r\n\t\t\t\tfor (let file of this.files) {\r\n\t\t\t\t\tconsole.log(\"file\", file);\r\n\t\t\t\t\tconsole.log(\"this.requestData: \", this.requestData);\r\n\t\t\t\t\tresponse = await globalService.uploadData_Async(\r\n\t\t\t\t\t\tadministratorAPI.API_UploadFile365(),\r\n\t\t\t\t\t\tfile,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tparentItemId: this.requestData.idDirectoryPath,\r\n\t\t\t\t\t\t\tuserId: this.userInfo.id,\r\n\t\t\t\t\t\t\trequestDataId: this.requestData.id,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (!response) {\r\n\t\t\t\t\t\treturn this.toastError(this.$t(\"error.upload_file\"));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!response.state) {\r\n\t\t\t\t\t\treturn this.toastError(response.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.attachmentFiles.push(response.data);\r\n\t\t\t\t\tconsole.log(\"response file\", response);\r\n\t\t\t\t\tthis.files = [];\r\n\t\t\t\t\t//this.$emit(constant.keys.upload, true);\r\n\t\t\t\t}\r\n\t\t\t\tthis.$emit(\"save\", this.attachmentFiles);\r\n\t\t\t\tthis.closeDialog();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.toastError(error);\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"]},"metadata":{},"sourceType":"module"}