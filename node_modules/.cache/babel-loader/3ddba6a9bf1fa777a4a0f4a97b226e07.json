{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.function.name.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport globalService from \"@/services/global.service\";\nimport userService from \"@/services/user.service\";\nimport authService from \"@/modules/graph/services/auth.service\";\nimport AuthAPI from \"./auth.api\";\nimport UserInfoDto from \"@/models/user-info.dto\";\nimport constant from \"@/common/constant\";\nexport default {\n  name: \"SignInVue\",\n  data: function data() {\n    return {\n      valid: true,\n      username: \"\",\n      password: \"\",\n      rememberMe: false,\n      showPassword: false,\n      selection: 1,\n      askPassword: false,\n      file: null,\n      usernameError: \"\",\n      passwordError: \"\"\n    };\n  },\n  watch: {\n    username: function username(value) {\n      if (!value) {\n        this.usernameError = this.$t(\"error.required\");\n      } else if (!this.validateUsername(value)) {\n        this.usernameError = this.$t(\"error.invalid_username\");\n      } else if (\"\".concat(value).length > constant.values.MAX_LENGTH) {\n        this.usernameError = this.$t(\"validator.max_length_255\");\n      } else {\n        this.usernameError = \"\";\n      }\n\n      this.username = \"\".concat(value).trim().substring(0, constant.values.MAX_LENGTH - 1);\n    },\n    password: function password(value) {\n      if (!value) {\n        this.passwordError = this.$t(\"error.required\");\n      } else if (!this.validatePassword(value)) {\n        this.passwordError = this.$t(\"error.invalid_password\");\n      } else if (\"\".concat(value).length > constant.values.MAX_LENGTH) {\n        this.passwordError = this.$t(\"validator.max_length_255\");\n      } else {\n        this.passwordError = \"\";\n      }\n\n      this.password = \"\".concat(value).trim().substring(0, constant.values.MAX_LENGTH - 1);\n    }\n  },\n  computed: {\n    safeUsername: function safeUsername() {\n      return \"\".concat(this.username).trim().substring(0, constant.values.MAX_LENGTH - 1);\n    },\n    safePassword: function safePassword() {\n      return \"\".concat(this.password).trim().substring(0, constant.values.MAX_LENGTH - 1);\n    }\n  },\n  mounted: function mounted() {},\n  methods: {\n    back: function back() {\n      this.askPassword = false;\n    },\n    signIn: function signIn() {\n      var _arguments = arguments,\n          _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var event, response;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                event = _arguments.length > 0 && _arguments[0] !== undefined ? _arguments[0] : false;\n                event.preventDefault();\n\n                if (_this.askPassword) {\n                  _context.next = 5;\n                  break;\n                }\n\n                _this.askPassword = !!_this.username;\n                return _context.abrupt(\"return\");\n\n              case 5:\n                _context.prev = 5;\n                _context.next = 8;\n                return globalService.getData_Async(\"/api/user-infos/1\");\n\n              case 8:\n                response = _context.sent;\n\n                if (response) {\n                  _context.next = 11;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 11:\n                if (response.state) {\n                  _context.next = 13;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 13:\n                userService.setUserInfo(response.data);\n\n                _this.$router.push({\n                  path: \"/\"\n                });\n\n                _context.next = 20;\n                break;\n\n              case 17:\n                _context.prev = 17;\n                _context.t0 = _context[\"catch\"](5);\n                console.log(_context.t0);\n\n              case 20:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[5, 17]]);\n      }))();\n    },\n    signInOnMicrosoft: function signInOnMicrosoft() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var token, user, response, userDto, createUserResponse;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return authService.login();\n\n              case 3:\n                _context2.next = 5;\n                return authService.acquireToken();\n\n              case 5:\n                token = _context2.sent;\n\n                if (token) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 8:\n                user = authService.user();\n                _context2.next = 11;\n                return globalService.getData_Async(AuthAPI.API_GetUserByMicrosoftUsername(user.username));\n\n              case 11:\n                response = _context2.sent;\n\n                if (!(!response || !response.state)) {\n                  _context2.next = 14;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", _this2.toastError(\"error.fetch_microsoft_user\"));\n\n              case 14:\n                if (response.data.length) {\n                  _context2.next = 29;\n                  break;\n                }\n\n                userDto = UserInfoDto;\n                userDto.idInMicrosoft = user.username;\n                userDto.infoInMicrosoft = JSON.stringify(user);\n                userDto.fullName = user.name;\n                _context2.next = 21;\n                return globalService.postData_Async(AuthAPI.API_SaveUser(), userDto);\n\n              case 21:\n                createUserResponse = _context2.sent;\n\n                if (createUserResponse) {\n                  _context2.next = 24;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", _this2.toastError(_this2.$t(\"error.login\")));\n\n              case 24:\n                if (createUserResponse.state) {\n                  _context2.next = 26;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", _this2.toastError(createUserResponse.message));\n\n              case 26:\n                userService.setUserInfo(createUserResponse.data);\n\n                _this2.$router.push({\n                  path: \"/\"\n                });\n\n                return _context2.abrupt(\"return\");\n\n              case 29:\n                userService.setUserInfo(response.data[0]);\n\n                _this2.$router.push({\n                  path: \"/\"\n                });\n\n                _context2.next = 37;\n                break;\n\n              case 33:\n                _context2.prev = 33;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.log(_context2.t0);\n\n                _this2.toastError(_context2.t0);\n\n              case 37:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[0, 33]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["name","data","valid","username","password","rememberMe","showPassword","selection","askPassword","file","usernameError","passwordError","watch","value","trim","substring","constant","computed","safeUsername","safePassword","mounted","methods","back","signIn","event","globalService","response","userService","path","console","signInOnMicrosoft","authService","token","user","AuthAPI","userDto","UserInfoDto","createUserResponse"],"sourceRoot":"src/views/modules/auth","sources":["sign-in.vue"],"sourcesContent":["<template>\r\n\t<v-card class=\"ma-auto mt-15\" max-width=\"500\">\r\n\t\t<v-img\r\n\t\t\tclass=\"elevation-4\"\r\n\t\t\tcontain\r\n\t\t\tsrc=\"/img/backgrounds/VRE.jpg\"\r\n\t\t></v-img>\r\n\t\t<v-card-title>{{ $t(\"title.sign_in\") }}</v-card-title>\r\n\t\t<v-card-text>\r\n\t\t\t<v-container class=\"p-5\">\r\n\t\t\t\t<v-row>\r\n\t\t\t\t\t<v-btn\r\n\t\t\t\t\t\televation=\"0\"\r\n\t\t\t\t\t\twidth=\"100%\"\r\n\t\t\t\t\t\tclass=\"blue darken-1 rounded-pill\"\r\n\t\t\t\t\t\tdark\r\n\t\t\t\t\t\tx-large\r\n\t\t\t\t\t\t@click=\"signInOnMicrosoft\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{{ $t(\"button.sign_in_microsoft\") }}\r\n\t\t\t\t\t\t<v-icon> mdi-microsoft-windows </v-icon>\r\n\t\t\t\t\t</v-btn>\r\n\t\t\t\t</v-row>\r\n\t\t\t\t<v-row class=\"mt-6\">\r\n\t\t\t\t\t<v-col cols=\"4\">\r\n\t\t\t\t\t\t<v-divider class=\"mt-2\"></v-divider>\r\n\t\t\t\t\t</v-col>\r\n\t\t\t\t\t<v-col cols=\"4\">\r\n\t\t\t\t\t\t<span>{{ $t(\"label.sign_in_with_username\") }} </span>\r\n\t\t\t\t\t</v-col>\r\n\t\t\t\t\t<v-col cols=\"4\">\r\n\t\t\t\t\t\t<v-divider class=\"mt-2\"></v-divider>\r\n\t\t\t\t\t</v-col>\r\n\t\t\t\t</v-row>\r\n\t\t\t\t<v-form\r\n\t\t\t\t\tref=\"form\"\r\n\t\t\t\t\tv-model=\"valid\"\r\n\t\t\t\t\tlazy-validation\r\n\t\t\t\t\t@submit=\"signIn($event)\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{{ $t(\"title.email\") }}\r\n\t\t\t\t\t<span class=\"text-red-600\">\r\n\t\t\t\t\t\t{{ $t(\"label.star\") }}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<v-text-field\r\n\t\t\t\t\t\tv-model=\"username\"\r\n\t\t\t\t\t\t:value=\"safeUsername\"\r\n\t\t\t\t\t\t:error-messages=\"usernameError\"\r\n\t\t\t\t\t\tdense\r\n\t\t\t\t\t\toutlined\r\n\t\t\t\t\t>\r\n\t\t\t\t\t</v-text-field>\r\n\t\t\t\t\t{{ $t(\"title.password\") }}\r\n\t\t\t\t\t<span class=\"text-red-600\">\r\n\t\t\t\t\t\t{{ $t(\"label.star\") }}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<v-text-field\r\n\t\t\t\t\t\tv-model=\"password\"\r\n\t\t\t\t\t\t:value=\"safePassword\"\r\n\t\t\t\t\t\t:append-icon=\"showPassword ? 'mdi-eye' : 'mdi-eye-off'\"\r\n\t\t\t\t\t\t:type=\"showPassword ? 'text' : 'password'\"\r\n\t\t\t\t\t\t:error-messages=\"passwordError\"\r\n\t\t\t\t\t\t@click:append=\"showPassword = !showPassword\"\r\n\t\t\t\t\t\tdense\r\n\t\t\t\t\t\toutlined\r\n\t\t\t\t\t></v-text-field>\r\n\t\t\t\t\t<v-checkbox :label=\"$t('label.remember_me')\"></v-checkbox>\r\n\t\t\t\t\t<v-btn\r\n\t\t\t\t\t\tcolor=\"primary darken-1\"\r\n\t\t\t\t\t\tdark\r\n\t\t\t\t\t\tclass=\"rounded-pill\"\r\n\t\t\t\t\t\twidth=\"100%\"\r\n\t\t\t\t\t\tx-large\r\n\t\t\t\t\t\t@click=\"signIn\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{{ $t(\"button.sign_in\") }}\r\n\t\t\t\t\t\t<!-- <v-icon> mdi-arrow-right </v-icon> -->\r\n\t\t\t\t\t</v-btn>\r\n\t\t\t\t</v-form>\r\n\t\t\t</v-container>\r\n\t\t</v-card-text>\r\n\t</v-card>\r\n</template>\r\n\r\n<script>\r\nimport globalService from \"@/services/global.service\";\r\nimport userService from \"@/services/user.service\";\r\nimport authService from \"@/modules/graph/services/auth.service\";\r\nimport AuthAPI from \"./auth.api\";\r\nimport UserInfoDto from \"@/models/user-info.dto\";\r\nimport constant from \"@/common/constant\";\r\nexport default {\r\n\tname: \"SignInVue\",\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tvalid: true,\r\n\t\t\tusername: \"\",\r\n\t\t\tpassword: \"\",\r\n\t\t\trememberMe: false,\r\n\t\t\tshowPassword: false,\r\n\t\t\tselection: 1,\r\n\t\t\taskPassword: false,\r\n\t\t\tfile: null,\r\n\t\t\tusernameError: \"\",\r\n\t\t\tpasswordError: \"\",\r\n\t\t};\r\n\t},\r\n\twatch: {\r\n\t\tusername(value) {\r\n\t\t\tif (!value) {\r\n\t\t\t\tthis.usernameError = this.$t(\"error.required\");\r\n\t\t\t} else if (!this.validateUsername(value)) {\r\n\t\t\t\tthis.usernameError = this.$t(\"error.invalid_username\");\r\n\t\t\t} else if (`${value}`.length > constant.values.MAX_LENGTH) {\r\n\t\t\t\tthis.usernameError = this.$t(\"validator.max_length_255\");\r\n\t\t\t} else {\r\n\t\t\t\tthis.usernameError = \"\";\r\n\t\t\t}\r\n\t\t\tthis.username = `${value}`\r\n\t\t\t\t.trim()\r\n\t\t\t\t.substring(0, constant.values.MAX_LENGTH - 1);\r\n\t\t},\r\n\t\tpassword(value) {\r\n\t\t\tif (!value) {\r\n\t\t\t\tthis.passwordError = this.$t(\"error.required\");\r\n\t\t\t} else if (!this.validatePassword(value)) {\r\n\t\t\t\tthis.passwordError = this.$t(\"error.invalid_password\");\r\n\t\t\t} else if (`${value}`.length > constant.values.MAX_LENGTH) {\r\n\t\t\t\tthis.passwordError = this.$t(\"validator.max_length_255\");\r\n\t\t\t} else {\r\n\t\t\t\tthis.passwordError = \"\";\r\n\t\t\t}\r\n\t\t\tthis.password = `${value}`\r\n\t\t\t\t.trim()\r\n\t\t\t\t.substring(0, constant.values.MAX_LENGTH - 1);\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tsafeUsername() {\r\n\t\t\treturn `${this.username}`\r\n\t\t\t\t.trim()\r\n\t\t\t\t.substring(0, constant.values.MAX_LENGTH - 1);\r\n\t\t},\r\n\t\tsafePassword() {\r\n\t\t\treturn `${this.password}`\r\n\t\t\t\t.trim()\r\n\t\t\t\t.substring(0, constant.values.MAX_LENGTH - 1);\r\n\t\t},\r\n\t},\r\n\tmounted() {},\r\n\tmethods: {\r\n\t\tback() {\r\n\t\t\tthis.askPassword = false;\r\n\t\t},\r\n\t\tasync signIn(event = false) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (!this.askPassword) {\r\n\t\t\t\tthis.askPassword = !!this.username;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet response;\r\n\t\t\ttry {\r\n\t\t\t\tresponse = await globalService.getData_Async(\r\n\t\t\t\t\t\"/api/user-infos/1\",\r\n\t\t\t\t);\r\n\t\t\t\tif (!response) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (!response.state) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tuserService.setUserInfo(response.data);\r\n\t\t\t\tthis.$router.push({ path: \"/\" });\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync signInOnMicrosoft() {\r\n\t\t\ttry {\r\n\t\t\t\tawait authService.login();\r\n\t\t\t\tlet token = await authService.acquireToken();\r\n\t\t\t\tif (!token) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet user = authService.user();\r\n\t\t\t\tlet response = await globalService.getData_Async(\r\n\t\t\t\t\tAuthAPI.API_GetUserByMicrosoftUsername(user.username),\r\n\t\t\t\t);\r\n\t\t\t\tif (!response || !response.state) {\r\n\t\t\t\t\treturn this.toastError(\"error.fetch_microsoft_user\");\r\n\t\t\t\t}\r\n\t\t\t\tif (!response.data.length) {\r\n\t\t\t\t\tlet userDto = UserInfoDto;\r\n\t\t\t\t\tuserDto.idInMicrosoft = user.username;\r\n\t\t\t\t\tuserDto.infoInMicrosoft = JSON.stringify(user);\r\n\t\t\t\t\tuserDto.fullName = user.name;\r\n\t\t\t\t\tlet createUserResponse = await globalService.postData_Async(\r\n\t\t\t\t\t\tAuthAPI.API_SaveUser(),\r\n\t\t\t\t\t\tuserDto,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (!createUserResponse) {\r\n\t\t\t\t\t\treturn this.toastError(this.$t(\"error.login\"));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!createUserResponse.state) {\r\n\t\t\t\t\t\treturn this.toastError(createUserResponse.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuserService.setUserInfo(createUserResponse.data);\r\n\t\t\t\t\tthis.$router.push({ path: \"/\" });\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tuserService.setUserInfo(response.data[0]);\r\n\t\t\t\tthis.$router.push({ path: \"/\" });\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t\tthis.toastError(err);\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n"]},"metadata":{},"sourceType":"module"}