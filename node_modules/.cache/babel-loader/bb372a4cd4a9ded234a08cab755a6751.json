{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport globalService from \"@/services/global.service\";\nimport administratorAPI from \"../administrator.api\";\nimport store from \"@/store\";\nimport graphService from \"@/modules/graph/services/graph.service\";\nimport authService from \"@/modules/graph/services/auth.service\";\nimport attachmentFileService from \"@/views/modules/administrator/AttachmentFile/attachment-file.service\";\nimport constant from \"@/common/constant\";\nexport default {\n  name: \"EditTemplateFormVue\",\n  components: {},\n  props: {\n    templateFormDto: {},\n    oldFile: {}\n  },\n  watch: {\n    templateFormDto: function templateFormDto(value) {\n      this.editedItem = value;\n      this.fileEditing = false;\n      this.$refs[\"file\"].reset();\n    },\n    oldFile: function oldFile(value) {\n      this.m_file = value;\n      this.fileEditing = false;\n      this.$refs[\"file\"].reset();\n      this.fileId = null;\n    }\n  },\n  computed: {\n    formTitle: function formTitle() {\n      return !this.editedItem.id ? this.$t(\"title.create_form\") : this.$t(\"title.edit_form\");\n    },\n    form: function form() {\n      return {\n        templateFormName: this.editedItem.templateFormName\n      };\n    }\n  },\n  data: function data() {\n    return {\n      user_infor: this.getUserInfo(),\n      valid: false,\n      formError: false,\n      isSaving: false,\n      editedItem: {},\n      attachmentFileDto: {},\n      errorMessage: \"\",\n      errorMessageDes: \"\",\n      file: null,\n      errorMessageFile: \"\",\n      m_file: {},\n      defaultItem: {\n        created: null,\n        createdDate: new Date(),\n        createdName: \"\",\n        description: \"\",\n        fileExtension: \"\",\n        fullPath: \"\",\n        id: null,\n        isActive: true,\n        isDelete: false,\n        modified: null,\n        modifiedDate: new Date(),\n        modifiedName: \"\",\n        ofice365Path: \"\",\n        path: \"\",\n        templateFormCode: \"\",\n        templateFormName: \"\",\n        tennant: null,\n        tennantCode: \"\",\n        tennantName: \"\"\n      },\n      fileFormat: [\"doc\", \"docm\", \"docx\", \"docb\", \"dot\", \"dotm\", \"dotx\", \"wbk\", \"csv\", \"odt\", \"pdf\", \"rtf\", \"txt\", \"wps\", \"xml\", \"xps\", \"xls\", \"xlsx\", \"pps\", \"ppsx\", \"ppt\", \"pptm\", \"pptx\", \"xls\"],\n      fileId: null,\n      fileEditing: false,\n      interval: null,\n      regex: /[`!@#$%^&*()_+\\-[\\]{};':\"\\\\|<>/?~]/\n    };\n  },\n  created: function created() {\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              store.state.loading = true;\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              store.state.loading = false;\n              _this.editedItem = _this.templateFormDto;\n              _this.m_file = _this.oldFile;\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }))();\n  },\n  methods: {\n    close: function close() {\n      this.errorMessage = \"\";\n      this.errorMessageDes = \"\";\n      this.errorMessageFile = \"\";\n      this.$refs[\"file\"].reset();\n      this.editedItem = Object.assign({}, this.defaultItem);\n      this.$emit(\"close\", true);\n    },\n    _save: function _save() {\n      var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.editedItem;\n      this.$emit(\"save\", value);\n    },\n    handleFileUpload: function handleFileUpload(event) {\n      this.file = event;\n\n      if (this.file) {\n        this.errorMessageFile = \"\";\n      }\n    },\n    save: function save() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var _i, _Object$keys, key, response;\n\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                // if (\n                // \tthis.file &&\n                // \tthis.file.name &&\n                // \tthis.regex.test(this.file.name)\n                // ) {\n                // \treturn (\n                // \t\tthis.toastError(this.$t(\"message.filename_err\")),\n                // \t\tconsole.log(\"name\", this.file.name)\n                // \t);\n                // }\n                _this2.formError = false;\n\n                for (_i = 0, _Object$keys = Object.keys(_this2.form); _i < _Object$keys.length; _i++) {\n                  key = _Object$keys[_i];\n\n                  if (!_this2.form[key] || _this2.form[key].trim().length == 0) {\n                    _this2.formError = true;\n\n                    _this2.$refs[key].focus();\n                  }\n\n                  _this2.$refs[key].validate(true);\n                }\n\n                if (!_this2.formError) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this2.errorMessage = _this2.$t(\"message.msg_1\"));\n\n              case 4:\n                if (!(!_this2.editedItem.id && !_this2.file)) {\n                  _context3.next = 8;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this2.errorMessageFile = _this2.$t(\"error.empty_file\"));\n\n              case 8:\n                _this2.errorMessageFile = \"\";\n\n                if (!(_this2.file && _this2.file.name && _this2.fileFormat.indexOf(_this2.file.name.split(\".\").pop()) == -1)) {\n                  _context3.next = 12;\n                  break;\n                }\n\n                _this2.toastError(_this2.$t(\"message.err_format_file\"));\n\n                return _context3.abrupt(\"return\");\n\n              case 12:\n                if (!_this2.isSaving) {\n                  _context3.next = 14;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 14:\n                _this2.isSaving = true;\n                _this2.editedItem.templateFormName = _this2.editedItem.templateFormName.trim();\n                _this2.editedItem.description = _this2.editedItem.description.trim();\n\n                if (!_this2.editedItem.id) {\n                  _this2.editedItem.created = _this2.getUserInfo();\n                  _this2.editedItem.createdName = _this2.getUserInfo().fullName;\n                  _this2.editedItem.createdDate = new Date();\n                }\n\n                _this2.editedItem.modified = _this2.getUserInfo();\n                _this2.editedItem.modifiedName = _this2.getUserInfo().fullName;\n                _this2.editedItem.modifiedDate = new Date();\n                _context3.prev = 21;\n\n                if (_this2.editedItem.id) {\n                  _context3.next = 30;\n                  break;\n                }\n\n                _context3.next = 25;\n                return globalService.postData_Async(administratorAPI.API_CreateTemplateForm(), _this2.editedItem);\n\n              case 25:\n                response = _context3.sent;\n\n                if (!(!response || !response.state)) {\n                  _context3.next = 28;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this2.toastError(_this2.$t(\"message.add_error\")));\n\n              case 28:\n                _context3.next = 35;\n                break;\n\n              case 30:\n                _context3.next = 32;\n                return globalService.putData_Async(administratorAPI.API_SaveTemplateForm(_this2.editedItem.id), _this2.editedItem);\n\n              case 32:\n                response = _context3.sent;\n\n                if (!(!response || !response.state)) {\n                  _context3.next = 35;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this2.toastError(_this2.$t(\"message.update_error\")));\n\n              case 35:\n                _this2.editedItem = response.data;\n\n                if (!_this2.file) {\n                  _context3.next = 47;\n                  break;\n                }\n\n                _context3.next = 39;\n                return globalService.uploadData_Async(administratorAPI.API_UploadFile(), _this2.file, {\n                  isFolder: 0,\n                  needEncrypt: true,\n                  contentType: _this2.file.type,\n                  templateFormId: _this2.editedItem.id\n                });\n\n              case 39:\n                response = _context3.sent;\n\n                if (response) {\n                  _context3.next = 42;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this2.toastError(_this2.$t(\"error.upload_file\")));\n\n              case 42:\n                if (response.state) {\n                  _context3.next = 44;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _this2.toastError(response.message));\n\n              case 44:\n                _this2.attachmentFileDto = response.data;\n                _context3.next = 47;\n                return _this2.createAttachmentFile();\n\n              case 47:\n                _this2._save(_this2.editedItem);\n\n                _this2.isSaving = false;\n\n                _this2.close();\n\n                _this2.toastSuccess(_this2.$t(\"message.update_success\"));\n\n                _context3.next = 56;\n                break;\n\n              case 53:\n                _context3.prev = 53;\n                _context3.t0 = _context3[\"catch\"](21);\n\n                _this2.toastError(_context3.t0);\n\n              case 56:\n                _context3.prev = 56;\n                _this2.isSaving = false;\n                return _context3.finish(56);\n\n              case 59:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[21, 53, 56, 59]]);\n      }))();\n    },\n    onKeyUp: function onKeyUp() {\n      if (this.editedItem.templateFormName != \"\" || this.editedItem.templateFormName.length < 255) {\n        this.errorMessage = \"\";\n      }\n\n      if (this.editedItem.templateFormName.length > 255) {\n        this.errorMessage = this.$t(\"message.maxlength_required_255\");\n      }\n    },\n    onKeyUpDes: function onKeyUpDes() {\n      if (this.editedItem.description != \"\" || this.editedItem.description.length < 255) {\n        this.errorMessageDes = \"\";\n      }\n\n      if (this.editedItem.description.length > 255) {\n        this.errorMessageDes = this.$t(\"message.maxlength_required_255\");\n      }\n    },\n    createAttachmentFile: function createAttachmentFile() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var isDeleted, response;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _this3.attachmentFileDto.created = _this3.getUserInfo();\n                _this3.attachmentFileDto.createdDate = new Date();\n                _this3.attachmentFileDto.modified = _this3.getUserInfo();\n                _this3.attachmentFileDto.modifiedDate = new Date();\n                _context4.prev = 4;\n                _context4.next = 7;\n                return attachmentFileService.deleteAllByTemplateFormId(_this3.editedItem.id);\n\n              case 7:\n                isDeleted = _context4.sent;\n\n                if (isDeleted) {\n                  _context4.next = 10;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", _this3.toastError(_this3.$t(\"error.delete_old_attachment_file\")));\n\n              case 10:\n                _context4.next = 12;\n                return globalService.postData_Async(administratorAPI.API_CreateAttachmentFile(), _this3.attachmentFileDto);\n\n              case 12:\n                response = _context4.sent;\n\n                if (!(!response || !response.state)) {\n                  _context4.next = 15;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\");\n\n              case 15:\n                _this3.attachmentFileNew = response.data;\n                _context4.next = 21;\n                break;\n\n              case 18:\n                _context4.prev = 18;\n                _context4.t0 = _context4[\"catch\"](4);\n\n                _this3.toastError(_context4.t0);\n\n              case 21:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[4, 18]]);\n      }))();\n    },\n    _downloadFileUrl: function _downloadFileUrl(item) {\n      if (!item || !item.id) {\n        return;\n      }\n\n      if (!this.m_file) {\n        return;\n      }\n\n      var description = JSON.parse(this.m_file.description);\n      return administratorAPI.FullAPI_DownloadFile(this.m_file.idInFileService, this.m_file.fileName, this.m_file.fileExtension, description.contentType);\n    },\n    openEditFile: function openEditFile() {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var fileResponse, uploadResponse, updateAttachmentFileResponse, handler;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.prev = 0;\n\n                if (authService.user()) {\n                  _context5.next = 4;\n                  break;\n                }\n\n                _context5.next = 4;\n                return authService.login();\n\n              case 4:\n                _context5.next = 6;\n                return globalService.downloadBlob_Async(_this4._downloadFileUrl(_this4.editedItem));\n\n              case 6:\n                fileResponse = _context5.sent;\n\n                if (fileResponse) {\n                  _context5.next = 9;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", _this4.toastError(_this4.$t(\"error.load_file\")));\n\n              case 9:\n                _context5.next = 11;\n                return graphService.uploadFile(_this4.m_file.fileName, fileResponse);\n\n              case 11:\n                uploadResponse = _context5.sent;\n\n                if (uploadResponse) {\n                  _context5.next = 14;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", _this4.toastError(\"error.upload_to_office_365\"));\n\n              case 14:\n                _this4.m_file.ofice365Path = uploadResponse.webUrl;\n                _this4.fileId = uploadResponse.id;\n                _context5.next = 18;\n                return globalService.putData_Async(administratorAPI.API_SaveAttachmentFile(_this4.m_file.id), _this4.m_file);\n\n              case 18:\n                updateAttachmentFileResponse = _context5.sent;\n\n                if (updateAttachmentFileResponse) {\n                  _context5.next = 21;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", _this4.toastError(\"error.save\"));\n\n              case 21:\n                _this4.editWindow = window.open(uploadResponse.webUrl, \"targetWindow\", \"toolbar=no,\\n\\t\\t\\t\\t\\tlocation=no,\\n\\t\\t\\t\\t\\tstatus=no,\\n\\t\\t\\t\\t\\tmenubar=no,\\n\\t\\t\\t\\t\\tscrollbars=yes,\\n\\t\\t\\t\\t\\tresizable=yes,\\n\\t\\t\\t\\t\\twidth=1600,\\n\\t\\t\\t\\t\\theight=800\");\n                handler = _this4._handle;\n                _this4.interval = setInterval(handler, constant.values.interval);\n                _this4.fileEditing = true;\n                _context5.next = 30;\n                break;\n\n              case 27:\n                _context5.prev = 27;\n                _context5.t0 = _context5[\"catch\"](0);\n\n                _this4.toastError(_context5.t0);\n\n              case 30:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, null, [[0, 27]]);\n      }))();\n    },\n    _handle: function _handle() {\n      var _this5 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (_this5.editWindow) {\n                  _context6.next = 2;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\");\n\n              case 2:\n                if (_this5.editWindow.closed) {\n                  _context6.next = 4;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\");\n\n              case 4:\n                if (_this5.fileId) {\n                  _context6.next = 6;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\");\n\n              case 6:\n                clearInterval(_this5.interval);\n                _context6.next = 9;\n                return _this5.sync();\n\n              case 9:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }))();\n    },\n    sync: function sync() {\n      var _this6 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        var getUrlResponse, response, updateResponse;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.prev = 0;\n                _context7.next = 3;\n                return graphService.getDownloadUrlByFileId(_this6.fileId);\n\n              case 3:\n                getUrlResponse = _context7.sent;\n\n                if (getUrlResponse) {\n                  _context7.next = 6;\n                  break;\n                }\n\n                return _context7.abrupt(\"return\", _this6.toastError(_this6.$t(\"error.download_from_office_365\")));\n\n              case 6:\n                _context7.next = 8;\n                return globalService.downloadBlob_Async(getUrlResponse.data[\"@microsoft.graph.downloadUrl\"]);\n\n              case 8:\n                response = _context7.sent;\n\n                if (response) {\n                  _context7.next = 11;\n                  break;\n                }\n\n                return _context7.abrupt(\"return\", _this6.toastError(_this6.$t(\"error.download_from_office_365\")));\n\n              case 11:\n                _context7.next = 13;\n                return globalService.updateFile_Async(administratorAPI.API_UpdateFile(_this6.m_file.idInFileService, _this6.m_file.fileName), response);\n\n              case 13:\n                updateResponse = _context7.sent;\n\n                if (updateResponse) {\n                  _context7.next = 16;\n                  break;\n                }\n\n                return _context7.abrupt(\"return\", _this6.toastError(_this6.$t(\"error.save\")));\n\n              case 16:\n                if (updateResponse.state) {\n                  _context7.next = 18;\n                  break;\n                }\n\n                return _context7.abrupt(\"return\", _this6.toastError(updateResponse.message));\n\n              case 18:\n                _this6.editWindow.close();\n\n                _this6.fileEditing = false;\n\n                _this6._save(_this6.editedItem);\n\n                _context7.next = 26;\n                break;\n\n              case 23:\n                _context7.prev = 23;\n                _context7.t0 = _context7[\"catch\"](0);\n\n                _this6.toastError(_context7.t0);\n\n              case 26:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, null, [[0, 23]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["name","components","props","templateFormDto","oldFile","watch","value","computed","formTitle","form","templateFormName","data","user_infor","valid","formError","isSaving","editedItem","attachmentFileDto","errorMessage","errorMessageDes","file","errorMessageFile","m_file","defaultItem","created","createdDate","createdName","description","fileExtension","fullPath","id","isActive","isDelete","modified","modifiedDate","modifiedName","ofice365Path","path","templateFormCode","tennant","tennantCode","tennantName","fileFormat","fileId","fileEditing","interval","regex","store","mounted","methods","close","_save","handleFileUpload","event","save","key","globalService","administratorAPI","response","isFolder","needEncrypt","contentType","templateFormId","onKeyUp","onKeyUpDes","createAttachmentFile","attachmentFileService","isDeleted","_downloadFileUrl","item","openEditFile","authService","fileResponse","graphService","uploadResponse","updateAttachmentFileResponse","handler","_handle","clearInterval","sync","getUrlResponse","updateResponse"],"sourceRoot":"src/views/modules/administrator/TemplateForm","sources":["EditTemplateForm.vue"],"sourcesContent":["<template>\r\n\t<v-card elevation=\"0\" ref=\"form\">\r\n\t\t<v-toolbar>\r\n\t\t\t<v-toolbar-title> {{ formTitle }}</v-toolbar-title>\r\n\t\t\t<v-spacer></v-spacer>\r\n\t\t\t<v-btn icon @click=\"close\">\r\n\t\t\t\t<v-icon>mdi-close</v-icon>\r\n\t\t\t</v-btn>\r\n\t\t</v-toolbar>\r\n\t\t<v-card-text class=\"mt-3\">\r\n\t\t\t<v-container>\r\n\t\t\t\t<v-form v-model=\"valid\">\r\n\t\t\t\t\t<v-row>\r\n\t\t\t\t\t\t<v-col cols=\"12\" sm=\"12\" md=\"12\">\r\n\t\t\t\t\t\t\t<m-text-field\r\n\t\t\t\t\t\t\t\t:label=\"$t('label.name_form')\"\r\n\t\t\t\t\t\t\t\t:value=\"editedItem.templateFormName\"\r\n\t\t\t\t\t\t\t\t@value=\"\r\n\t\t\t\t\t\t\t\t\t(v) => (editedItem.templateFormName = v)\r\n\t\t\t\t\t\t\t\t\"\r\n\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</v-col>\r\n\t\t\t\t\t\t<v-col cols=\"12\" sm=\"12\" md=\"12\">\r\n\t\t\t\t\t\t\t<v-textarea\r\n\t\t\t\t\t\t\t\tref=\"description\"\r\n\t\t\t\t\t\t\t\tv-model=\"editedItem.description\"\r\n\t\t\t\t\t\t\t\t:label=\"$t('label.description')\"\r\n\t\t\t\t\t\t\t\tdense\r\n\t\t\t\t\t\t\t\toutlined\r\n\t\t\t\t\t\t\t\t:error-messages=\"errorMessageDes\"\r\n\t\t\t\t\t\t\t\t@keyup=\"onKeyUpDes\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t</v-textarea>\r\n\t\t\t\t\t\t</v-col>\r\n\t\t\t\t\t\t<v-col cols=\"12\" sm=\"12\" md=\"12\">\r\n\t\t\t\t\t\t\t<v-file-input\r\n\t\t\t\t\t\t\t\tref=\"file\"\r\n\t\t\t\t\t\t\t\toutlined\r\n\t\t\t\t\t\t\t\tdense\r\n\t\t\t\t\t\t\t\taccept=\".xlsx,.xls,image/*,.doc, .docx,.ppt, .pptx,.txt,.pdf\"\r\n\t\t\t\t\t\t\t\t@change=\"handleFileUpload($event)\"\r\n\t\t\t\t\t\t\t\t:error-messages=\"errorMessageFile\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<template v-slot:label>\r\n\t\t\t\t\t\t\t\t\t<p v-if=\"m_file && !file\">\r\n\t\t\t\t\t\t\t\t\t\t{{ m_file.fileName }}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p v-else>\r\n\t\t\t\t\t\t\t\t\t\t{{ $t(\"label.attachment_file\") }}\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"text-red\">\r\n\t\t\t\t\t\t\t\t\t\t\t{{ $t(\"label.star\") }}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t\t\t<template v-if=\"m_file\" v-slot:append>\r\n\t\t\t\t\t\t\t\t\t<v-btn\r\n\t\t\t\t\t\t\t\t\t\tv-if=\"!file && fileEditing\"\r\n\t\t\t\t\t\t\t\t\t\ticon\r\n\t\t\t\t\t\t\t\t\t\tcolor=\"blue\"\r\n\t\t\t\t\t\t\t\t\t\tdark\r\n\t\t\t\t\t\t\t\t\t\t@click=\"sync\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<v-icon> mdi-sync </v-icon>\r\n\t\t\t\t\t\t\t\t\t</v-btn>\r\n\t\t\t\t\t\t\t\t\t<v-btn\r\n\t\t\t\t\t\t\t\t\t\tv-if=\"!file && !fileEditing\"\r\n\t\t\t\t\t\t\t\t\t\ticon\r\n\t\t\t\t\t\t\t\t\t\tcolor=\"blue\"\r\n\t\t\t\t\t\t\t\t\t\tdark\r\n\t\t\t\t\t\t\t\t\t\t@click=\"openEditFile\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<v-icon> mdi-pencil </v-icon>\r\n\t\t\t\t\t\t\t\t\t</v-btn>\r\n\t\t\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t\t</v-file-input>\r\n\t\t\t\t\t\t</v-col>\r\n\r\n\t\t\t\t\t\t<v-col cols=\"12\" sm=\"12\" md=\"12\">\r\n\t\t\t\t\t\t\t<v-checkbox\r\n\t\t\t\t\t\t\t\tv-model=\"editedItem.isActive\"\r\n\t\t\t\t\t\t\t\t:label=\"$t('label.is_active')\"\r\n\t\t\t\t\t\t\t></v-checkbox>\r\n\t\t\t\t\t\t</v-col>\r\n\t\t\t\t\t</v-row>\r\n\t\t\t\t</v-form>\r\n\t\t\t</v-container>\r\n\t\t</v-card-text>\r\n\t\t<v-card-actions>\r\n\t\t\t<v-spacer></v-spacer>\r\n\t\t\t<v-btn\r\n\t\t\t\televation=\"0\"\r\n\t\t\t\tcolor=\"blue darken-2\"\r\n\t\t\t\tdark\r\n\t\t\t\tclass=\"rounded-0 mr-2\"\r\n\t\t\t\t@click=\"save\"\r\n\t\t\t>\r\n\t\t\t\t{{ $t(\"button.ok\") }}\r\n\t\t\t</v-btn>\r\n\t\t\t<v-btn\r\n\t\t\t\televation=\"0\"\r\n\t\t\t\tcolor=\"grey lighten-4\"\r\n\t\t\t\tclass=\"rounded-0\"\r\n\t\t\t\t@click=\"close\"\r\n\t\t\t>\r\n\t\t\t\t{{ $t(\"button.cancel\") }}\r\n\t\t\t</v-btn>\r\n\t\t</v-card-actions>\r\n\t</v-card>\r\n</template>\r\n\r\n<script>\r\nimport globalService from \"@/services/global.service\";\r\nimport administratorAPI from \"../administrator.api\";\r\nimport store from \"@/store\";\r\nimport graphService from \"@/modules/graph/services/graph.service\";\r\nimport authService from \"@/modules/graph/services/auth.service\";\r\nimport attachmentFileService from \"@/views/modules/administrator/AttachmentFile/attachment-file.service\";\r\nimport constant from \"@/common/constant\";\r\nexport default {\r\n\tname: \"EditTemplateFormVue\",\r\n\tcomponents: {},\r\n\tprops: {\r\n\t\ttemplateFormDto: {},\r\n\t\toldFile: {},\r\n\t},\r\n\twatch: {\r\n\t\ttemplateFormDto(value) {\r\n\t\t\tthis.editedItem = value;\r\n\t\t\tthis.fileEditing = false;\r\n\t\t\tthis.$refs[\"file\"].reset();\r\n\t\t},\r\n\t\toldFile(value) {\r\n\t\t\tthis.m_file = value;\r\n\t\t\tthis.fileEditing = false;\r\n\t\t\tthis.$refs[\"file\"].reset();\r\n\t\t\tthis.fileId = null;\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tformTitle() {\r\n\t\t\treturn !this.editedItem.id\r\n\t\t\t\t? this.$t(\"title.create_form\")\r\n\t\t\t\t: this.$t(\"title.edit_form\");\r\n\t\t},\r\n\t\tform() {\r\n\t\t\treturn {\r\n\t\t\t\ttemplateFormName: this.editedItem.templateFormName,\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tuser_infor: this.getUserInfo(),\r\n\t\t\tvalid: false,\r\n\t\t\tformError: false,\r\n\t\t\tisSaving: false,\r\n\t\t\teditedItem: {},\r\n\t\t\tattachmentFileDto: {},\r\n\t\t\terrorMessage: \"\",\r\n\t\t\terrorMessageDes: \"\",\r\n\t\t\tfile: null,\r\n\t\t\terrorMessageFile: \"\",\r\n\t\t\tm_file: {},\r\n\t\t\tdefaultItem: {\r\n\t\t\t\tcreated: null,\r\n\t\t\t\tcreatedDate: new Date(),\r\n\t\t\t\tcreatedName: \"\",\r\n\t\t\t\tdescription: \"\",\r\n\t\t\t\tfileExtension: \"\",\r\n\t\t\t\tfullPath: \"\",\r\n\t\t\t\tid: null,\r\n\t\t\t\tisActive: true,\r\n\t\t\t\tisDelete: false,\r\n\t\t\t\tmodified: null,\r\n\t\t\t\tmodifiedDate: new Date(),\r\n\t\t\t\tmodifiedName: \"\",\r\n\t\t\t\tofice365Path: \"\",\r\n\t\t\t\tpath: \"\",\r\n\t\t\t\ttemplateFormCode: \"\",\r\n\t\t\t\ttemplateFormName: \"\",\r\n\t\t\t\ttennant: null,\r\n\t\t\t\ttennantCode: \"\",\r\n\t\t\t\ttennantName: \"\",\r\n\t\t\t},\r\n\t\t\tfileFormat: [\r\n\t\t\t\t\"doc\",\r\n\t\t\t\t\"docm\",\r\n\t\t\t\t\"docx\",\r\n\t\t\t\t\"docb\",\r\n\t\t\t\t\"dot\",\r\n\t\t\t\t\"dotm\",\r\n\t\t\t\t\"dotx\",\r\n\t\t\t\t\"wbk\",\r\n\t\t\t\t\"csv\",\r\n\t\t\t\t\"odt\",\r\n\t\t\t\t\"pdf\",\r\n\t\t\t\t\"rtf\",\r\n\t\t\t\t\"txt\",\r\n\t\t\t\t\"wps\",\r\n\t\t\t\t\"xml\",\r\n\t\t\t\t\"xps\",\r\n\t\t\t\t\"xls\",\r\n\t\t\t\t\"xlsx\",\r\n\t\t\t\t\"pps\",\r\n\t\t\t\t\"ppsx\",\r\n\t\t\t\t\"ppt\",\r\n\t\t\t\t\"pptm\",\r\n\t\t\t\t\"pptx\",\r\n\t\t\t\t\"xls\",\r\n\t\t\t],\r\n\t\t\tfileId: null,\r\n\t\t\tfileEditing: false,\r\n\t\t\tinterval: null,\r\n\t\t\tregex: /[`!@#$%^&*()_+\\-[\\]{};':\"\\\\|<>/?~]/,\r\n\t\t};\r\n\t},\r\n\tasync created() {\r\n\t\tstore.state.loading = true;\r\n\t},\r\n\tasync mounted() {\r\n\t\tstore.state.loading = false;\r\n\t\tthis.editedItem = this.templateFormDto;\r\n\t\tthis.m_file = this.oldFile;\r\n\t},\r\n\tmethods: {\r\n\t\tclose() {\r\n\t\t\tthis.errorMessage = \"\";\r\n\t\t\tthis.errorMessageDes = \"\";\r\n\t\t\tthis.errorMessageFile = \"\";\r\n\t\t\tthis.$refs[\"file\"].reset();\r\n\t\t\tthis.editedItem = Object.assign({}, this.defaultItem);\r\n\t\t\tthis.$emit(\"close\", true);\r\n\t\t},\r\n\t\t_save(value = this.editedItem) {\r\n\t\t\tthis.$emit(\"save\", value);\r\n\t\t},\r\n\t\thandleFileUpload(event) {\r\n\t\t\tthis.file = event;\r\n\t\t\tif (this.file) {\r\n\t\t\t\tthis.errorMessageFile = \"\";\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync save() {\r\n\t\t\t// if (\r\n\t\t\t// \tthis.file &&\r\n\t\t\t// \tthis.file.name &&\r\n\t\t\t// \tthis.regex.test(this.file.name)\r\n\t\t\t// ) {\r\n\t\t\t// \treturn (\r\n\t\t\t// \t\tthis.toastError(this.$t(\"message.filename_err\")),\r\n\t\t\t// \t\tconsole.log(\"name\", this.file.name)\r\n\t\t\t// \t);\r\n\t\t\t// }\r\n\t\t\tthis.formError = false;\r\n\t\t\tfor (let key of Object.keys(this.form)) {\r\n\t\t\t\tif (!this.form[key] || this.form[key].trim().length == 0) {\r\n\t\t\t\t\tthis.formError = true;\r\n\t\t\t\t\tthis.$refs[key].focus();\r\n\t\t\t\t}\r\n\t\t\t\tthis.$refs[key].validate(true);\r\n\t\t\t}\r\n\t\t\tif (this.formError) {\r\n\t\t\t\treturn (this.errorMessage = this.$t(\"message.msg_1\"));\r\n\t\t\t}\r\n\t\t\tif (!this.editedItem.id && !this.file) {\r\n\t\t\t\treturn (this.errorMessageFile = this.$t(\"error.empty_file\"));\r\n\t\t\t} else {\r\n\t\t\t\tthis.errorMessageFile = \"\";\r\n\t\t\t\tif (\r\n\t\t\t\t\tthis.file &&\r\n\t\t\t\t\tthis.file.name &&\r\n\t\t\t\t\tthis.fileFormat.indexOf(this.file.name.split(\".\").pop()) ==\r\n\t\t\t\t\t\t-1\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.toastError(this.$t(\"message.err_format_file\"));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.isSaving) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.isSaving = true;\r\n\t\t\tthis.editedItem.templateFormName =\r\n\t\t\t\tthis.editedItem.templateFormName.trim();\r\n\t\t\tthis.editedItem.description = this.editedItem.description.trim();\r\n\t\t\tif (!this.editedItem.id) {\r\n\t\t\t\tthis.editedItem.created = this.getUserInfo();\r\n\t\t\t\tthis.editedItem.createdName = this.getUserInfo().fullName;\r\n\t\t\t\tthis.editedItem.createdDate = new Date();\r\n\t\t\t}\r\n\t\t\tthis.editedItem.modified = this.getUserInfo();\r\n\t\t\tthis.editedItem.modifiedName = this.getUserInfo().fullName;\r\n\t\t\tthis.editedItem.modifiedDate = new Date();\r\n\t\t\tlet response;\r\n\t\t\ttry {\r\n\t\t\t\tif (!this.editedItem.id) {\r\n\t\t\t\t\tresponse = await globalService.postData_Async(\r\n\t\t\t\t\t\tadministratorAPI.API_CreateTemplateForm(),\r\n\t\t\t\t\t\tthis.editedItem,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (!response || !response.state) {\r\n\t\t\t\t\t\treturn this.toastError(this.$t(\"message.add_error\"));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresponse = await globalService.putData_Async(\r\n\t\t\t\t\t\tadministratorAPI.API_SaveTemplateForm(\r\n\t\t\t\t\t\t\tthis.editedItem.id,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tthis.editedItem,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (!response || !response.state) {\r\n\t\t\t\t\t\treturn this.toastError(this.$t(\"message.update_error\"));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.editedItem = response.data;\r\n\t\t\t\tif (this.file) {\r\n\t\t\t\t\tresponse = await globalService.uploadData_Async(\r\n\t\t\t\t\t\tadministratorAPI.API_UploadFile(),\r\n\t\t\t\t\t\tthis.file,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tisFolder: 0,\r\n\t\t\t\t\t\t\tneedEncrypt: true,\r\n\t\t\t\t\t\t\tcontentType: this.file.type,\r\n\t\t\t\t\t\t\ttemplateFormId: this.editedItem.id,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (!response) {\r\n\t\t\t\t\t\treturn this.toastError(this.$t(\"error.upload_file\"));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!response.state) {\r\n\t\t\t\t\t\treturn this.toastError(response.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.attachmentFileDto = response.data;\r\n\t\t\t\t\tawait this.createAttachmentFile();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._save(this.editedItem);\r\n\t\t\t\tthis.isSaving = false;\r\n\t\t\t\tthis.close();\r\n\t\t\t\tthis.toastSuccess(this.$t(\"message.update_success\"));\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.toastError(error);\r\n\t\t\t} finally {\r\n\t\t\t\tthis.isSaving = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonKeyUp() {\r\n\t\t\tif (\r\n\t\t\t\tthis.editedItem.templateFormName != \"\" ||\r\n\t\t\t\tthis.editedItem.templateFormName.length < 255\r\n\t\t\t) {\r\n\t\t\t\tthis.errorMessage = \"\";\r\n\t\t\t}\r\n\t\t\tif (this.editedItem.templateFormName.length > 255) {\r\n\t\t\t\tthis.errorMessage = this.$t(\"message.maxlength_required_255\");\r\n\t\t\t}\r\n\t\t},\r\n\t\tonKeyUpDes() {\r\n\t\t\tif (\r\n\t\t\t\tthis.editedItem.description != \"\" ||\r\n\t\t\t\tthis.editedItem.description.length < 255\r\n\t\t\t) {\r\n\t\t\t\tthis.errorMessageDes = \"\";\r\n\t\t\t}\r\n\t\t\tif (this.editedItem.description.length > 255) {\r\n\t\t\t\tthis.errorMessageDes = this.$t(\r\n\t\t\t\t\t\"message.maxlength_required_255\",\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync createAttachmentFile() {\r\n\t\t\tthis.attachmentFileDto.created = this.getUserInfo();\r\n\t\t\tthis.attachmentFileDto.createdDate = new Date();\r\n\t\t\tthis.attachmentFileDto.modified = this.getUserInfo();\r\n\t\t\tthis.attachmentFileDto.modifiedDate = new Date();\r\n\t\t\ttry {\r\n\t\t\t\tlet isDeleted =\r\n\t\t\t\t\tawait attachmentFileService.deleteAllByTemplateFormId(\r\n\t\t\t\t\t\tthis.editedItem.id,\r\n\t\t\t\t\t);\r\n\t\t\t\tif (!isDeleted) {\r\n\t\t\t\t\treturn this.toastError(\r\n\t\t\t\t\t\tthis.$t(\"error.delete_old_attachment_file\"),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tlet response = await globalService.postData_Async(\r\n\t\t\t\t\tadministratorAPI.API_CreateAttachmentFile(),\r\n\t\t\t\t\tthis.attachmentFileDto,\r\n\t\t\t\t);\r\n\t\t\t\tif (!response || !response.state) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.attachmentFileNew = response.data;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.toastError(error);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_downloadFileUrl(item) {\r\n\t\t\tif (!item || !item.id) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!this.m_file) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet description = JSON.parse(this.m_file.description);\r\n\t\t\treturn administratorAPI.FullAPI_DownloadFile(\r\n\t\t\t\tthis.m_file.idInFileService,\r\n\t\t\t\tthis.m_file.fileName,\r\n\t\t\t\tthis.m_file.fileExtension,\r\n\t\t\t\tdescription.contentType,\r\n\t\t\t);\r\n\t\t},\r\n\t\tasync openEditFile() {\r\n\t\t\ttry {\r\n\t\t\t\tif (!authService.user()) {\r\n\t\t\t\t\tawait authService.login();\r\n\t\t\t\t}\r\n\t\t\t\tlet fileResponse = await globalService.downloadBlob_Async(\r\n\t\t\t\t\tthis._downloadFileUrl(this.editedItem),\r\n\t\t\t\t);\r\n\t\t\t\tif (!fileResponse) {\r\n\t\t\t\t\treturn this.toastError(this.$t(\"error.load_file\"));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet uploadResponse = await graphService.uploadFile(\r\n\t\t\t\t\tthis.m_file.fileName,\r\n\t\t\t\t\tfileResponse,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!uploadResponse) {\r\n\t\t\t\t\treturn this.toastError(\"error.upload_to_office_365\");\r\n\t\t\t\t}\r\n\t\t\t\tthis.m_file.ofice365Path = uploadResponse.webUrl;\r\n\t\t\t\tthis.fileId = uploadResponse.id;\r\n\t\t\t\tlet updateAttachmentFileResponse =\r\n\t\t\t\t\tawait globalService.putData_Async(\r\n\t\t\t\t\t\tadministratorAPI.API_SaveAttachmentFile(this.m_file.id),\r\n\t\t\t\t\t\tthis.m_file,\r\n\t\t\t\t\t);\r\n\t\t\t\tif (!updateAttachmentFileResponse) {\r\n\t\t\t\t\treturn this.toastError(\"error.save\");\r\n\t\t\t\t}\r\n\t\t\t\tthis.editWindow = window.open(\r\n\t\t\t\t\tuploadResponse.webUrl,\r\n\t\t\t\t\t\"targetWindow\",\r\n\t\t\t\t\t`toolbar=no,\r\n\t\t\t\t\tlocation=no,\r\n\t\t\t\t\tstatus=no,\r\n\t\t\t\t\tmenubar=no,\r\n\t\t\t\t\tscrollbars=yes,\r\n\t\t\t\t\tresizable=yes,\r\n\t\t\t\t\twidth=1600,\r\n\t\t\t\t\theight=800`,\r\n\t\t\t\t);\r\n\t\t\t\tlet handler = this._handle;\r\n\t\t\t\tthis.interval = setInterval(handler, constant.values.interval);\r\n\t\t\t\tthis.fileEditing = true;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.toastError(error);\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync _handle() {\r\n\t\t\tif (!this.editWindow) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!this.editWindow.closed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!this.fileId) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tclearInterval(this.interval);\r\n\t\t\tawait this.sync();\r\n\t\t},\r\n\t\tasync sync() {\r\n\t\t\ttry {\r\n\t\t\t\tlet getUrlResponse = await graphService.getDownloadUrlByFileId(\r\n\t\t\t\t\tthis.fileId,\r\n\t\t\t\t);\r\n\t\t\t\tif (!getUrlResponse) {\r\n\t\t\t\t\treturn this.toastError(\r\n\t\t\t\t\t\tthis.$t(\"error.download_from_office_365\"),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tlet response = await globalService.downloadBlob_Async(\r\n\t\t\t\t\tgetUrlResponse.data[\"@microsoft.graph.downloadUrl\"],\r\n\t\t\t\t);\r\n\t\t\t\tif (!response) {\r\n\t\t\t\t\treturn this.toastError(\r\n\t\t\t\t\t\tthis.$t(\"error.download_from_office_365\"),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tlet updateResponse = await globalService.updateFile_Async(\r\n\t\t\t\t\tadministratorAPI.API_UpdateFile(\r\n\t\t\t\t\t\tthis.m_file.idInFileService,\r\n\t\t\t\t\t\tthis.m_file.fileName,\r\n\t\t\t\t\t),\r\n\t\t\t\t\tresponse,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!updateResponse) {\r\n\t\t\t\t\treturn this.toastError(this.$t(\"error.save\"));\r\n\t\t\t\t}\r\n\t\t\t\tif (!updateResponse.state) {\r\n\t\t\t\t\treturn this.toastError(updateResponse.message);\r\n\t\t\t\t}\r\n\t\t\t\tthis.editWindow.close();\r\n\t\t\t\tthis.fileEditing = false;\r\n\t\t\t\tthis._save(this.editedItem);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.toastError(error);\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<style></style>\r\n"]},"metadata":{},"sourceType":"module"}