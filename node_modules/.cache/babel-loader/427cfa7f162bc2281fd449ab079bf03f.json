{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _createForOfIteratorHelper from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _toConsumableArray from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _objectSpread from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _typeof from \"C:/Users/nam/OneDrive/M\\xE1y t\\xEDnh/New folder/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.string.ends-with.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.find-index.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport copy from 'fast-copy';\nimport selectUtils from '../utils/select';\nexport default {\n  data: function data() {\n    return {\n      editabledArrayProp: {\n        currentDialog: null,\n        editItem: null,\n        editedItems: {}\n      }\n    };\n  },\n  computed: {\n    isEditableArray: function isEditableArray() {\n      if (this.resolvedSchema.type === 'array' && this.resolvedSchema.items && this.resolvedSchema.items.type === 'object') return true;\n    },\n    readonlyItemSchema: function readonlyItemSchema() {\n      var _this = this;\n\n      if (!this.fullSchema || !this.fullSchema.items) return;\n      var schema = copy(this.fullSchema.items); // hide titles that are displayed in headers and do not need a text field\n      // but do not remove them, we need them for validation\n\n      if (this.itemTitle) {\n        if (schema.properties && schema.properties[this.itemTitle] && _typeof(schema.properties[this.itemTitle]) === 'object') {\n          schema.properties[this.itemTitle]['x-style'] = 'display: none;';\n        }\n\n        if (schema.oneOf) {\n          schema.oneOf.forEach(function (value) {\n            if (value.properties[_this.itemTitle]) {\n              value.properties[_this.itemTitle]['x-style'] = 'display: none;';\n            }\n          });\n        }\n\n        if (this.fullSchema.items.allOf) {\n          schema.allOf.forEach(function (value) {\n            if (value.properties[_this.itemTitle]) {\n              value.properties[_this.itemTitle]['x-style'] = 'display: none;';\n            }\n          });\n        }\n      }\n\n      return schema;\n    }\n  },\n  methods: {\n    renderArrayItemModal: function renderArrayItemModal(h, item, i) {\n      var _this2 = this;\n\n      var isNew = i === -1;\n      var itemProperty;\n\n      if (this.editabledArrayProp.currentDialog === i) {\n        itemProperty = this.renderArrayItemEdit(h, i, true);\n      }\n\n      var scopedSlots = {\n        activator: function activator() {\n          return _this2.renderArrayItemEditButton(h, item, i);\n        }\n      };\n\n      var close = function close() {\n        itemProperty.componentInstance.resetValidation();\n        _this2.editabledArrayProp.currentDialog = null;\n      };\n\n      var on = {};\n      if (!this.fullOptions.dialogProps.persistent) on['click:outside'] = close;\n      return h('v-dialog', {\n        props: _objectSpread(_objectSpread({}, this.fullOptions.dialogProps), {}, {\n          value: this.editabledArrayProp.currentDialog === i,\n          closeOnContentClick: false\n        }),\n        scopedSlots: scopedSlots,\n        on: on\n      }, [h('v-card', {\n        props: this.fullOptions.dialogCardProps\n      }, [h('v-card-title', this.itemTitle && item[this.itemTitle]), h('v-card-text', [itemProperty]), h('v-card-actions', [h('v-spacer'), h('v-btn', {\n        props: {\n          text: true\n        },\n        on: {\n          click: close\n        },\n        attrs: {\n          id: this.fullOptions.idPrefix + this.dashKey + '--dialog-cancel-button'\n        },\n        class: {\n          'vjsf-array-dialog-cancel-button': true\n        }\n      }, 'cancel'), h('v-btn', {\n        props: {\n          color: 'primary'\n        },\n        on: {\n          click: function click() {\n            if (!itemProperty.componentInstance.validate(true)) return;\n\n            var value = _toConsumableArray(_this2.value);\n\n            if (isNew) {\n              _this2.editabledArrayProp.editedItems[_this2.value.length] = true;\n              value.push(_this2.editabledArrayProp.editItem);\n            } else {\n              _this2.editabledArrayProp.editedItems[i] = true;\n\n              _this2.$set(value, i, _objectSpread({}, _this2.editabledArrayProp.editItem));\n            }\n\n            _this2.input(value);\n\n            _this2.change();\n\n            _this2.shouldValidate = true;\n            _this2.editabledArrayProp.currentDialog = null;\n          }\n        },\n        attrs: {\n          id: this.fullOptions.idPrefix + this.dashKey + '--dialog-ok-button'\n        },\n        class: {\n          'vjsf-array-dialog-ok-button': true\n        }\n      }, 'ok')])])]);\n    },\n    renderArrayItemRO: function renderArrayItemRO(h, item, i) {\n      var _this3 = this;\n\n      var modelKey = \"item-\".concat(i);\n      var renderOptions = {\n        props: {\n          schema: this.readonlyItemSchema,\n          value: item,\n          modelRoot: this.modelRoot || this.value,\n          modelKey: modelKey,\n          parentKey: \"\".concat(this.fullKey, \".\"),\n          options: _objectSpread(_objectSpread({}, this.fullOptions), {}, {\n            disableAll: true,\n            readOnlyArrayItem: true\n          }),\n          optionsRoot: this.initialOptions,\n          sectionDepth: this.sectionDepth + 1,\n          separateValidation: false,\n          sharedData: this.sharedData\n        },\n        ref: modelKey,\n        scopedSlots: this.childScopedSlots(this.fullSchema.key)\n      };\n\n      if (this.options.autoFixArrayItems) {\n        renderOptions.on = {\n          input: function input(itemValue) {\n            // even if it is readOnly we listen to changes in order to fill default values in array\n            // already present in the model\n            if (!_this3.editabledArrayProp.editedItems[i]) {\n              var value = _toConsumableArray(_this3.value);\n\n              value[i] = itemValue;\n\n              _this3.input(value);\n            }\n          }\n        };\n      }\n\n      return h('v-jsf', renderOptions, this.childSlots(h, this.fullSchema.key));\n    },\n    renderArrayItemEditButton: function renderArrayItemEditButton(h, item, i, isCurrentInlineEdit) {\n      var _this4 = this;\n\n      var isNew = i === -1;\n      var fabIcon = isCurrentInlineEdit || isNew;\n      return h('v-btn', {\n        on: {\n          click: function click() {\n            if (isNew && _this4.fullOptions.editMode === 'inline') {\n              var editItem = copy(item);\n\n              var value = _toConsumableArray(_this4.value);\n\n              value.push(editItem);\n              _this4.editabledArrayProp.currentDialog = value.length - 1;\n              _this4.editabledArrayProp.editItem = editItem;\n\n              _this4.input(value);\n\n              _this4.change();\n            } else if (_this4.editabledArrayProp.currentDialog === i) {\n              _this4.editabledArrayProp.editItem = null;\n              _this4.editabledArrayProp.currentDialog = null;\n\n              _this4.change();\n            } else {\n              _this4.editabledArrayProp.editItem = copy(item);\n              _this4.editabledArrayProp.currentDialog = i; // show validation errors right away when editing an item\n\n              if (_this4.fullOptions.editMode === 'inline') {\n                _this4.$nextTick(function () {\n                  return _this4.childrenInputs[\"item-\".concat(i)].validate(true);\n                });\n              }\n            }\n          }\n        },\n        attrs: {\n          id: this.fullOptions.idPrefix + this.dashKey + '-' + (isNew ? '-add' : i + '--edit') + '-button'\n        },\n        class: {\n          'vjsf-array-add-button': true,\n          'ml-3': isNew\n        },\n        props: {\n          icon: !fabIcon,\n          fab: fabIcon,\n          small: isNew,\n          'x-small': isCurrentInlineEdit,\n          color: 'primary',\n          depressed: isCurrentInlineEdit\n        }\n      }, [h('v-icon', isNew ? this.fullOptions.icons.add : this.fullOptions.icons.edit)]);\n    },\n    renderArrayItemEdit: function renderArrayItemEdit(h, i, autofocus) {\n      var _this5 = this;\n\n      var options = _objectSpread(_objectSpread({}, this.fullOptions), {}, {\n        autofocus: autofocus\n      });\n\n      if (!this.fullOptions.idPrefix.endsWith('--dialog--')) {\n        options.idPrefix = this.fullOptions.idPrefix + '--dialog--';\n      }\n\n      return h('v-jsf', {\n        props: {\n          schema: this.fullSchema.items,\n          value: this.editabledArrayProp.editItem,\n          modelRoot: this.modelRoot || this.value,\n          modelKey: \"item-\".concat(i),\n          parentKey: \"\".concat(this.fullKey, \".\"),\n          options: options,\n          optionsRoot: this.initialOptions,\n          sectionDepth: this.sectionDepth + 1,\n          separateValidation: this.fullOptions.editMode !== 'inline',\n          sharedData: this.sharedData\n        },\n        scopedSlots: this.childScopedSlots(this.fullSchema.key),\n        ref: 'item-' + i,\n        on: {\n          error: function error(e) {\n            return _this5.$emit('error', e);\n          },\n          input: function input(itemValue) {\n            _this5.editabledArrayProp.editItem = itemValue;\n\n            if (_this5.fullOptions.editMode === 'inline') {\n              var value = _toConsumableArray(_this5.value);\n\n              _this5.$set(value, i, itemValue);\n\n              _this5.input(value);\n            }\n          },\n          change: function change() {\n            if (_this5.fullOptions.editMode === 'inline') {\n              _this5.change();\n            }\n          }\n        }\n      }, this.childSlots(h, this.fullSchema.key));\n    },\n    renderArrayItemMenu: function renderArrayItemMenu(h, item, header, isCurrentInlineEdit) {\n      var _this6 = this;\n\n      if (this.disabled || this.fromUrl || this.fullSchema.fromData) return;\n      var menuItems = [];\n\n      var _iterator = _createForOfIteratorHelper(this.fullOptions.arrayOperations),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var operation = _step.value;\n\n          if (operation === 'duplicate') {\n            menuItems.push({\n              title: this.fullOptions.messages.duplicate,\n              color: 'default',\n              icon: this.fullOptions.icons.duplicate,\n              disabled: false,\n              on: {\n                click: function click() {\n                  var index = _this6.value.findIndex(function (i) {\n                    return i === item;\n                  });\n\n                  var value = _toConsumableArray(_this6.value);\n\n                  value.splice(index, 0, _objectSpread({}, item));\n\n                  _this6.input(value);\n\n                  _this6.change();\n\n                  _this6.shouldValidate = true;\n                  header.componentInstance.validate();\n                }\n              }\n            });\n          }\n\n          if (operation === 'delete') {\n            menuItems.push({\n              title: this.fullOptions.messages.delete,\n              color: 'warning',\n              icon: this.fullOptions.icons.delete,\n              disabled: isCurrentInlineEdit,\n              on: {\n                click: function click() {\n                  var value = _this6.value.filter(function (i) {\n                    return i !== item;\n                  });\n\n                  _this6.input(value);\n\n                  _this6.change();\n\n                  _this6.shouldValidate = true;\n                  header.componentInstance.validate();\n                }\n              }\n            });\n          }\n\n          if (operation === 'copy' && this.fullSchema['x-arrayGroup']) {\n            menuItems.push({\n              title: this.fullOptions.messages.copy,\n              color: 'default',\n              icon: this.fullOptions.icons.copy,\n              disabled: false,\n              on: {\n                click: function click() {\n                  _this6.$set(_this6.sharedData, 'clipboard_' + _this6.fullSchema['x-arrayGroup'], item);\n                }\n              }\n            });\n          }\n\n          if (operation === 'paste' && this.fullSchema['x-arrayGroup']) {\n            menuItems.push({\n              title: this.fullOptions.messages.paste,\n              color: 'primary',\n              icon: this.fullOptions.icons.paste,\n              disabled: !this.sharedData['clipboard_' + this.fullSchema['x-arrayGroup']],\n              on: {\n                click: function click() {\n                  if (_this6.fullOptions.editMode === 'inline') {\n                    _this6.editabledArrayProp.editItem = null;\n                    _this6.editabledArrayProp.currentDialog = null;\n                  }\n\n                  var index = _this6.value.findIndex(function (i) {\n                    return i === item;\n                  });\n\n                  var value = _toConsumableArray(_this6.value);\n\n                  value[index] = _this6.sharedData['clipboard_' + _this6.fullSchema['x-arrayGroup']];\n\n                  _this6.input(value);\n\n                  _this6.change();\n\n                  _this6.shouldValidate = true;\n                  header.componentInstance.validate();\n                }\n              }\n            });\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      if (!menuItems.length) return; // if there is only one item, do not create a menu but instead a single button\n\n      if (menuItems.length === 1) {\n        return h('v-btn', {\n          props: {\n            icon: true,\n            disabled: menuItems[0].disabled\n          },\n          on: menuItems[0].on,\n          attrs: {\n            title: menuItems[0].title\n          },\n          class: 'ml-1'\n        }, [h('v-icon', {\n          props: {\n            color: menuItems[0].color\n          }\n        }, [menuItems[0].icon])]);\n      }\n\n      return h('v-menu', {\n        props: {\n          offsetY: true,\n          left: true\n        },\n        scopedSlots: {\n          activator: function activator(_ref) {\n            var on = _ref.on;\n            return h('v-btn', {\n              props: {\n                icon: true\n              },\n              attrs: {\n                title: _this6.fullOptions.messages.openMenu\n              },\n              class: 'ml-1',\n              on: on\n            }, [h('v-icon', _this6.fullOptions.icons.arrayMenu)]);\n          },\n          default: function _default() {\n            return h('v-list', {\n              class: 'pa-0',\n              props: {\n                dense: true\n              }\n            }, menuItems.map(function (menuItem) {\n              return h('v-list-item', {\n                on: menuItem.on,\n                props: {\n                  disabled: menuItem.disabled\n                }\n              }, [h('v-list-item-icon', {\n                class: 'mr-2'\n              }, [h('v-icon', {\n                props: {\n                  color: menuItem.color,\n                  small: true\n                }\n              }, [menuItem.icon])]), h('v-list-item-content', {}, [h('v-list-item-title', {}, [menuItem.title])])]);\n            }));\n          }\n        }\n      });\n    },\n    renderEditableArray: function renderEditableArray(h) {\n      var _this7 = this;\n\n      if (!this.isEditableArray) return;\n      var headerChildren = [];\n\n      if (!this.disabled && !this.fromUrl && !this.fullSchema.fromData && this.fullOptions.arrayOperations.includes('create')) {\n        var item = this.fullSchema.items.default || this.defaultValue(this.fullSchema.items);\n\n        if (this.fullOptions.editMode === 'inline') {\n          headerChildren.push(this.renderArrayItemEditButton(h, item, -1));\n        } else {\n          headerChildren.push(this.renderArrayItemModal(h, item, -1));\n        }\n      }\n\n      var header = h('v-input', {\n        class: 'mt-2 mb-3 pr-1 vjsf-array-header',\n        props: {\n          label: this.label,\n          rules: this.rules,\n          value: this.value,\n          validateOnBlur: !this.shouldValidate,\n          hideDetails: 'auto'\n        }\n      }, headerChildren);\n      var sortable = !this.fullOptions.disableSorting && !this.disabled;\n      var listItems;\n\n      if (this.value && this.value.length) {\n        listItems = this.value.filter(function (item) {\n          return !!item;\n        }).map(function (item, i) {\n          var editAction;\n          var isCurrentInlineEdit = _this7.fullOptions.editMode === 'inline' && _this7.editabledArrayProp.currentDialog === i;\n\n          if (!_this7.disabled && _this7.fullOptions.arrayOperations.includes('update')) {\n            if (_this7.fullOptions.editMode === 'inline') {\n              editAction = _this7.renderArrayItemEditButton(h, item, i, isCurrentInlineEdit);\n            } else {\n              editAction = _this7.renderArrayItemModal(h, item, i);\n            }\n          }\n\n          var actions = h('v-card-actions', {\n            class: 'pa-0'\n          }, [h('v-spacer'), editAction, _this7.renderArrayItemMenu(h, item, header, isCurrentInlineEdit)]);\n          var itemChild, cardStyle, itemKey;\n\n          if (isCurrentInlineEdit) {\n            itemChild = _this7.renderArrayItemEdit(h, i, false);\n            itemKey = 'item-edit-' + i;\n          } else {\n            itemChild = _this7.renderArrayItemRO(h, item, i);\n            itemKey = _this7.cached(\"item-key-\".concat(i), {\n              item: item\n            }, function () {\n              return \"\".concat(i, \"-\").concat(new Date().getTime());\n            });\n            if (sortable) cardStyle = 'cursor: move;';\n          }\n\n          var titleClass = 'py-2 pr-2 ' + _this7.fullOptions.arrayItemsTitlesClasses[_this7.sectionDepth] || _this7.fullOptions.arrayItemsTitlesClasses[_this7.fullOptions.arrayItemsTitlesClasses.length - 1];\n          var cardChildren = [h('v-card-title', {\n            props: {\n              primaryTitle: true\n            },\n            class: titleClass\n          }, [selectUtils.getObjectTitle(item, _this7.itemTitle, _this7.fullSchema), h('v-spacer'), actions]), h('v-card-text', [itemChild])];\n\n          var hasError = _this7.dedupChildrenWithValidatedErrors.includes(\"item-\".concat(i));\n\n          if (isCurrentInlineEdit) {\n            cardChildren = [h('v-alert', {\n              props: {\n                color: hasError ? 'error' : 'primary',\n                'colored-border': true,\n                border: 'left'\n              },\n              class: 'pa-0 pl-2 ma-0'\n            }, cardChildren)];\n          } else if (hasError) {\n            cardChildren = [h('v-alert', {\n              props: {\n                color: 'error',\n                outlined: true\n              },\n              class: 'pa-0 ma-0'\n            }, cardChildren)];\n          } else {\n            // this alert is not necessary at first sight, but without it the inside components are not reused\n            // when hasError changes and we can enter infinite loop where validation oscillates between ok/ko\n            cardChildren = [h('v-alert', {\n              props: {\n                color: 'default',\n                outlined: true\n              },\n              class: 'pa-0 ma-0 vjsf-invisible-alert'\n            }, cardChildren)];\n          }\n\n          var directives = [];\n\n          if (isCurrentInlineEdit) {\n            directives.push({\n              name: 'click-outside',\n              value: {\n                handler: function handler() {\n                  // exclude the case where the outside click triggered edition of another item\n                  if (_this7.editabledArrayProp.currentDialog === i) {\n                    if (_this7.fullOptions.editMode === 'inline') {\n                      _this7.editabledArrayProp.editItem = null;\n                      _this7.editabledArrayProp.currentDialog = null;\n\n                      _this7.change();\n                    }\n                  }\n                },\n                // cf https://github.com/vuetifyjs/vuetify/blob/master/packages/vuetify/src/components/VDialog/VDialog.ts#L290\n                include: _this7.getOpenDependentElements\n              }\n            });\n          }\n\n          var itemClass = 'py-1 vjsf-array-item';\n          if (isCurrentInlineEdit) itemClass += ' vjsf-array-item-active';\n          return h('v-col', {\n            props: _this7.fullOptions.arrayItemColProps,\n            class: itemClass,\n            key: itemKey\n          }, [h('v-card', {\n            props: _objectSpread({}, _this7.fullOptions.arrayItemCardProps),\n            style: cardStyle,\n            directives: directives\n          }, cardChildren)]);\n        });\n      }\n\n      var newValue;\n      var list = !sortable ? h('v-row', {\n        class: 'vjsf-array'\n      }, listItems) : h('draggable', {\n        props: {\n          value: this.value\n        },\n        attrs: _objectSpread({\n          group: this.fullSchema['x-arrayGroup'] || this.fullKey\n        }, this.fullOptions.sortableOptions),\n        class: 'row draggable vjsf-array',\n        on: {\n          change: function () {\n            var _change = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(evt) {\n              return _regeneratorRuntime().wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      if (!evt.added) {\n                        _context.next = 3;\n                        break;\n                      }\n\n                      _context.next = 3;\n                      return _this7.$nextTick();\n\n                    case 3:\n                      _this7.editabledArrayProp.editItem = null;\n                      _this7.editabledArrayProp.currentDialog = null;\n\n                      _this7.input(newValue);\n\n                      _this7.change();\n\n                      _this7.shouldValidate = true;\n\n                    case 8:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee);\n            }));\n\n            function change(_x) {\n              return _change.apply(this, arguments);\n            }\n\n            return change;\n          }(),\n          input: function () {\n            var _input = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(value) {\n              return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n                while (1) {\n                  switch (_context2.prev = _context2.next) {\n                    case 0:\n                      newValue = value;\n\n                    case 1:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }\n              }, _callee2);\n            }));\n\n            function input(_x2) {\n              return _input.apply(this, arguments);\n            }\n\n            return input;\n          }()\n        }\n      }, listItems);\n      return [header, list];\n    }\n  }\n};","map":{"version":3,"names":["copy","selectUtils","data","editabledArrayProp","currentDialog","editItem","editedItems","computed","isEditableArray","resolvedSchema","type","items","readonlyItemSchema","fullSchema","schema","itemTitle","properties","oneOf","forEach","value","allOf","methods","renderArrayItemModal","h","item","i","isNew","itemProperty","renderArrayItemEdit","scopedSlots","activator","renderArrayItemEditButton","close","componentInstance","resetValidation","on","fullOptions","dialogProps","persistent","props","closeOnContentClick","dialogCardProps","text","click","attrs","id","idPrefix","dashKey","class","color","validate","length","push","$set","input","change","shouldValidate","renderArrayItemRO","modelKey","renderOptions","modelRoot","parentKey","fullKey","options","disableAll","readOnlyArrayItem","optionsRoot","initialOptions","sectionDepth","separateValidation","sharedData","ref","childScopedSlots","key","autoFixArrayItems","itemValue","childSlots","isCurrentInlineEdit","fabIcon","editMode","$nextTick","childrenInputs","icon","fab","small","depressed","icons","add","edit","autofocus","endsWith","error","e","$emit","renderArrayItemMenu","header","disabled","fromUrl","fromData","menuItems","arrayOperations","operation","title","messages","duplicate","index","findIndex","splice","delete","filter","paste","offsetY","left","openMenu","arrayMenu","default","dense","map","menuItem","renderEditableArray","headerChildren","includes","defaultValue","label","rules","validateOnBlur","hideDetails","sortable","disableSorting","listItems","editAction","actions","itemChild","cardStyle","itemKey","cached","Date","getTime","titleClass","arrayItemsTitlesClasses","cardChildren","primaryTitle","getObjectTitle","hasError","dedupChildrenWithValidatedErrors","border","outlined","directives","name","handler","include","getOpenDependentElements","itemClass","arrayItemColProps","arrayItemCardProps","style","newValue","list","group","sortableOptions","evt","added"],"sources":["C:/Users/nam/OneDrive/Máy tính/New folder/node_modules/@koumoul/vjsf/lib/mixins/EditableArray.js"],"sourcesContent":["import copy from 'fast-copy'\nimport selectUtils from '../utils/select'\n\nexport default {\n  data() {\n    return {\n      editabledArrayProp: {\n        currentDialog: null,\n        editItem: null,\n        editedItems: {}\n      }\n    }\n  },\n  computed: {\n    isEditableArray() {\n      if (this.resolvedSchema.type === 'array' && this.resolvedSchema.items && this.resolvedSchema.items.type === 'object') return true\n    },\n    readonlyItemSchema() {\n      if (!this.fullSchema || !this.fullSchema.items) return\n\n      const schema = copy(this.fullSchema.items)\n      // hide titles that are displayed in headers and do not need a text field\n      // but do not remove them, we need them for validation\n      if (this.itemTitle) {\n        if (schema.properties && schema.properties[this.itemTitle] && typeof schema.properties[this.itemTitle] === 'object') {\n          schema.properties[this.itemTitle]['x-style'] = 'display: none;'\n        }\n        if (schema.oneOf) {\n          schema.oneOf.forEach((value) => {\n            if (value.properties[this.itemTitle]) {\n              value.properties[this.itemTitle]['x-style'] = 'display: none;'\n            }\n          })\n        }\n        if (this.fullSchema.items.allOf) {\n          schema.allOf.forEach((value) => {\n            if (value.properties[this.itemTitle]) {\n              value.properties[this.itemTitle]['x-style'] = 'display: none;'\n            }\n          })\n        }\n      }\n      return schema\n    }\n  },\n  methods: {\n    renderArrayItemModal(h, item, i) {\n      const isNew = i === -1\n      let itemProperty\n      if (this.editabledArrayProp.currentDialog === i) {\n        itemProperty = this.renderArrayItemEdit(h, i, true)\n      }\n\n      const scopedSlots = { activator: () => this.renderArrayItemEditButton(h, item, i) }\n      const close = () => {\n        itemProperty.componentInstance.resetValidation()\n        this.editabledArrayProp.currentDialog = null\n      }\n      const on = {}\n      if (!this.fullOptions.dialogProps.persistent) on['click:outside'] = close\n      return h('v-dialog', { props: { ...this.fullOptions.dialogProps, value: this.editabledArrayProp.currentDialog === i, closeOnContentClick: false }, scopedSlots, on }, [\n        h('v-card', { props: this.fullOptions.dialogCardProps }, [\n          h('v-card-title', this.itemTitle && item[this.itemTitle]),\n          h('v-card-text', [itemProperty]),\n          h('v-card-actions', [\n            h('v-spacer'),\n            h('v-btn', { props: { text: true },\n              on: { click: close },\n              attrs: { id: this.fullOptions.idPrefix + this.dashKey + '--dialog-cancel-button' },\n              class: { 'vjsf-array-dialog-cancel-button': true }\n            }, 'cancel'),\n            h('v-btn', { props: { color: 'primary' },\n              on: { click: () => {\n                if (!itemProperty.componentInstance.validate(true)) return\n                const value = [...this.value]\n                if (isNew) {\n                  this.editabledArrayProp.editedItems[this.value.length] = true\n                  value.push(this.editabledArrayProp.editItem)\n                } else {\n                  this.editabledArrayProp.editedItems[i] = true\n                  this.$set(value, i, { ...this.editabledArrayProp.editItem })\n                }\n                this.input(value)\n                this.change()\n                this.shouldValidate = true\n                this.editabledArrayProp.currentDialog = null\n              } },\n              attrs: { id: this.fullOptions.idPrefix + this.dashKey + '--dialog-ok-button' },\n              class: { 'vjsf-array-dialog-ok-button': true }\n            }, 'ok')\n          ])\n        ])\n      ])\n    },\n    renderArrayItemRO(h, item, i) {\n      const modelKey = `item-${i}`\n      const renderOptions = {\n        props: {\n          schema: this.readonlyItemSchema,\n          value: item,\n          modelRoot: this.modelRoot || this.value,\n          modelKey,\n          parentKey: `${this.fullKey}.`,\n          options: { ...this.fullOptions, disableAll: true, readOnlyArrayItem: true },\n          optionsRoot: this.initialOptions,\n          sectionDepth: this.sectionDepth + 1,\n          separateValidation: false,\n          sharedData: this.sharedData\n        },\n        ref: modelKey,\n        scopedSlots: this.childScopedSlots(this.fullSchema.key)\n      }\n      if (this.options.autoFixArrayItems) {\n        renderOptions.on = {\n          input: (itemValue) => {\n            // even if it is readOnly we listen to changes in order to fill default values in array\n            // already present in the model\n            if (!this.editabledArrayProp.editedItems[i]) {\n              const value = [...this.value]\n              value[i] = itemValue\n              this.input(value)\n            }\n          }\n        }\n      }\n      return h('v-jsf', renderOptions, this.childSlots(h, this.fullSchema.key))\n    },\n    renderArrayItemEditButton(h, item, i, isCurrentInlineEdit) {\n      const isNew = i === -1\n      const fabIcon = isCurrentInlineEdit || isNew\n      return h('v-btn', {\n        on: { click: () => {\n          if (isNew && this.fullOptions.editMode === 'inline') {\n            const editItem = copy(item)\n            const value = [...this.value]\n            value.push(editItem)\n            this.editabledArrayProp.currentDialog = value.length - 1\n            this.editabledArrayProp.editItem = editItem\n            this.input(value)\n            this.change()\n          } else if (this.editabledArrayProp.currentDialog === i) {\n            this.editabledArrayProp.editItem = null\n            this.editabledArrayProp.currentDialog = null\n            this.change()\n          } else {\n            this.editabledArrayProp.editItem = copy(item)\n            this.editabledArrayProp.currentDialog = i\n            // show validation errors right away when editing an item\n            if (this.fullOptions.editMode === 'inline') {\n              this.$nextTick(() => this.childrenInputs[`item-${i}`].validate(true))\n            }\n          }\n        } },\n        attrs: { id: this.fullOptions.idPrefix + this.dashKey + '-' + (isNew ? '-add' : i + '--edit') + '-button' },\n        class: { 'vjsf-array-add-button': true, 'ml-3': isNew },\n        props: { icon: !fabIcon, fab: fabIcon, small: isNew, 'x-small': isCurrentInlineEdit, color: 'primary', depressed: isCurrentInlineEdit } }, [\n        h('v-icon', isNew ? this.fullOptions.icons.add : this.fullOptions.icons.edit)\n      ])\n    },\n    renderArrayItemEdit(h, i, autofocus) {\n      const options = { ...this.fullOptions, autofocus }\n      if (!this.fullOptions.idPrefix.endsWith('--dialog--')) {\n        options.idPrefix = this.fullOptions.idPrefix + '--dialog--'\n      }\n\n      return h('v-jsf', {\n        props: {\n          schema: this.fullSchema.items,\n          value: this.editabledArrayProp.editItem,\n          modelRoot: this.modelRoot || this.value,\n          modelKey: `item-${i}`,\n          parentKey: `${this.fullKey}.`,\n          options,\n          optionsRoot: this.initialOptions,\n          sectionDepth: this.sectionDepth + 1,\n          separateValidation: this.fullOptions.editMode !== 'inline',\n          sharedData: this.sharedData\n        },\n        scopedSlots: this.childScopedSlots(this.fullSchema.key),\n        ref: 'item-' + i,\n        on: {\n          error: e => this.$emit('error', e),\n          input: itemValue => {\n            this.editabledArrayProp.editItem = itemValue\n            if (this.fullOptions.editMode === 'inline') {\n              const value = [...this.value]\n              this.$set(value, i, itemValue)\n              this.input(value)\n            }\n          },\n          change: () => {\n            if (this.fullOptions.editMode === 'inline') {\n              this.change()\n            }\n          }\n        }\n      }, this.childSlots(h, this.fullSchema.key))\n    },\n    renderArrayItemMenu(h, item, header, isCurrentInlineEdit) {\n      if (this.disabled || this.fromUrl || this.fullSchema.fromData) return\n      const menuItems = []\n\n      for (const operation of this.fullOptions.arrayOperations) {\n        if (operation === 'duplicate') {\n          menuItems.push({\n            title: this.fullOptions.messages.duplicate,\n            color: 'default',\n            icon: this.fullOptions.icons.duplicate,\n            disabled: false,\n            on: { click: () => {\n              const index = this.value.findIndex(i => i === item)\n              const value = [...this.value]\n              value.splice(index, 0, { ...item })\n              this.input(value)\n              this.change()\n              this.shouldValidate = true\n              header.componentInstance.validate()\n            } }\n          })\n        }\n\n        if (operation === 'delete') {\n          menuItems.push({\n            title: this.fullOptions.messages.delete,\n            color: 'warning',\n            icon: this.fullOptions.icons.delete,\n            disabled: isCurrentInlineEdit,\n            on: { click: () => {\n              const value = this.value.filter(i => i !== item)\n              this.input(value)\n              this.change()\n              this.shouldValidate = true\n              header.componentInstance.validate()\n            } }\n          })\n        }\n\n        if (operation === 'copy' && this.fullSchema['x-arrayGroup']) {\n          menuItems.push({\n            title: this.fullOptions.messages.copy,\n            color: 'default',\n            icon: this.fullOptions.icons.copy,\n            disabled: false,\n            on: { click: () => {\n              this.$set(this.sharedData, 'clipboard_' + this.fullSchema['x-arrayGroup'], item)\n            } }\n          })\n        }\n\n        if (operation === 'paste' && this.fullSchema['x-arrayGroup']) {\n          menuItems.push({\n            title: this.fullOptions.messages.paste,\n            color: 'primary',\n            icon: this.fullOptions.icons.paste,\n            disabled: !(this.sharedData['clipboard_' + this.fullSchema['x-arrayGroup']]),\n            on: { click: () => {\n              if (this.fullOptions.editMode === 'inline') {\n                this.editabledArrayProp.editItem = null\n                this.editabledArrayProp.currentDialog = null\n              }\n              const index = this.value.findIndex(i => i === item)\n              const value = [...this.value]\n              value[index] = this.sharedData['clipboard_' + this.fullSchema['x-arrayGroup']]\n              this.input(value)\n              this.change()\n              this.shouldValidate = true\n              header.componentInstance.validate()\n            } }\n          })\n        }\n      }\n\n      if (!menuItems.length) return\n\n      // if there is only one item, do not create a menu but instead a single button\n      if (menuItems.length === 1) {\n        return h('v-btn', {\n          props: { icon: true, disabled: menuItems[0].disabled },\n          on: menuItems[0].on,\n          attrs: { title: menuItems[0].title },\n          class: 'ml-1'\n        }, [h('v-icon', { props: { color: menuItems[0].color } }, [menuItems[0].icon])])\n      }\n      return h('v-menu', {\n        props: { offsetY: true, left: true },\n        scopedSlots: {\n          activator: ({ on }) => h('v-btn', {\n            props: { icon: true },\n            attrs: { title: this.fullOptions.messages.openMenu },\n            class: 'ml-1',\n            on\n          }, [h('v-icon', this.fullOptions.icons.arrayMenu)]),\n          default: () => h('v-list', { class: 'pa-0', props: { dense: true } }, menuItems.map(menuItem => h('v-list-item', {\n            on: menuItem.on,\n            props: { disabled: menuItem.disabled }\n          }, [\n            h('v-list-item-icon', { class: 'mr-2' }, [h('v-icon', { props: { color: menuItem.color, small: true } }, [menuItem.icon])]),\n            h('v-list-item-content', {}, [h('v-list-item-title', {}, [menuItem.title])])\n          ])))\n        }\n      })\n    },\n    renderEditableArray(h) {\n      if (!this.isEditableArray) return\n      const headerChildren = []\n      if (!this.disabled && !this.fromUrl && !this.fullSchema.fromData && this.fullOptions.arrayOperations.includes('create')) {\n        const item = this.fullSchema.items.default || this.defaultValue(this.fullSchema.items)\n        if (this.fullOptions.editMode === 'inline') {\n          headerChildren.push(this.renderArrayItemEditButton(h, item, -1))\n        } else {\n          headerChildren.push(this.renderArrayItemModal(h, item, -1))\n        }\n      }\n      const header = h('v-input', {\n        class: 'mt-2 mb-3 pr-1 vjsf-array-header',\n        props: { label: this.label, rules: this.rules, value: this.value, validateOnBlur: !this.shouldValidate, hideDetails: 'auto' }\n      }, headerChildren)\n\n      const sortable = !this.fullOptions.disableSorting && !this.disabled\n\n      let listItems\n      if (this.value && this.value.length) {\n        listItems = this.value.filter(item => !!item).map((item, i) => {\n          let editAction\n          const isCurrentInlineEdit = this.fullOptions.editMode === 'inline' && this.editabledArrayProp.currentDialog === i\n          if (!this.disabled && this.fullOptions.arrayOperations.includes('update')) {\n            if (this.fullOptions.editMode === 'inline') {\n              editAction = this.renderArrayItemEditButton(h, item, i, isCurrentInlineEdit)\n            } else {\n              editAction = this.renderArrayItemModal(h, item, i)\n            }\n          }\n\n          const actions = h('v-card-actions', { class: 'pa-0' }, [h('v-spacer'), editAction, this.renderArrayItemMenu(h, item, header, isCurrentInlineEdit)])\n\n          let itemChild, cardStyle, itemKey\n          if (isCurrentInlineEdit) {\n            itemChild = this.renderArrayItemEdit(h, i, false)\n            itemKey = 'item-edit-' + i\n          } else {\n            itemChild = this.renderArrayItemRO(h, item, i)\n            itemKey = this.cached(`item-key-${i}`, { item }, () => `${i}-${new Date().getTime()}`)\n            if (sortable) cardStyle = 'cursor: move;'\n          }\n\n          const titleClass = 'py-2 pr-2 ' + this.fullOptions.arrayItemsTitlesClasses[this.sectionDepth] || this.fullOptions.arrayItemsTitlesClasses[this.fullOptions.arrayItemsTitlesClasses.length - 1]\n\n          let cardChildren = [\n            h('v-card-title', { props: { primaryTitle: true }, class: titleClass }, [selectUtils.getObjectTitle(item, this.itemTitle, this.fullSchema), h('v-spacer'), actions]),\n            h('v-card-text', [itemChild])\n          ]\n\n          const hasError = this.dedupChildrenWithValidatedErrors.includes(`item-${i}`)\n          if (isCurrentInlineEdit) {\n            cardChildren = [h('v-alert', { props: { color: hasError ? 'error' : 'primary', 'colored-border': true, border: 'left' }, class: 'pa-0 pl-2 ma-0' }, cardChildren)]\n          } else if (hasError) {\n            cardChildren = [h('v-alert', { props: { color: 'error', outlined: true }, class: 'pa-0 ma-0' }, cardChildren)]\n          } else {\n            // this alert is not necessary at first sight, but without it the inside components are not reused\n            // when hasError changes and we can enter infinite loop where validation oscillates between ok/ko\n            cardChildren = [h('v-alert', { props: { color: 'default', outlined: true }, class: 'pa-0 ma-0 vjsf-invisible-alert' }, cardChildren)]\n          }\n          const directives = []\n          if (isCurrentInlineEdit) {\n            directives.push({\n              name: 'click-outside',\n              value: {\n                handler: () => {\n                  // exclude the case where the outside click triggered edition of another item\n                  if (this.editabledArrayProp.currentDialog === i) {\n                    if (this.fullOptions.editMode === 'inline') {\n                      this.editabledArrayProp.editItem = null\n                      this.editabledArrayProp.currentDialog = null\n                      this.change()\n                    }\n                  }\n                },\n                // cf https://github.com/vuetifyjs/vuetify/blob/master/packages/vuetify/src/components/VDialog/VDialog.ts#L290\n                include: this.getOpenDependentElements\n              }\n            })\n          }\n\n          let itemClass = 'py-1 vjsf-array-item'\n          if (isCurrentInlineEdit) itemClass += ' vjsf-array-item-active'\n          return h('v-col', { props: this.fullOptions.arrayItemColProps, class: itemClass, key: itemKey }, [\n            h('v-card', {\n              props: { ...this.fullOptions.arrayItemCardProps },\n              style: cardStyle,\n              directives\n            }, cardChildren)\n          ])\n        })\n      }\n\n      let newValue\n      const list = !sortable ? h('v-row', { class: 'vjsf-array' }, listItems) : h('draggable', {\n        props: { value: this.value },\n        attrs: { group: this.fullSchema['x-arrayGroup'] || this.fullKey, ...this.fullOptions.sortableOptions },\n        class: 'row draggable vjsf-array',\n        on: {\n          change: async (evt) => {\n            if (evt.added) await this.$nextTick()\n            this.editabledArrayProp.editItem = null\n            this.editabledArrayProp.currentDialog = null\n            this.input(newValue)\n            this.change()\n            this.shouldValidate = true\n          },\n          input: async (value) => {\n            newValue = value\n          }\n        } }, listItems)\n\n      return [header, list]\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}